
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Trainer &#8212; MineStudio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d6734ac8" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=00f267c6"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'online/trainer';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://craftjarvis.github.io/MineStudio/_static/version.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'latest';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <script defer="defer" src="../_static/custom-icons.js?v=26a3f3bc"></script>
    <link rel="icon" href="../_static/logo-no-text-light.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Rollout" href="rollout.html" />
    <link rel="prev" title="Configuring Online Training Sessions" href="config.html" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />   
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-no-text-light.svg" class="logo__image only-light" alt=""/>
    <img src="../_static/logo-no-text-light.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">MineStudio</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../overview/index.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../overview/getting-started.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../simulator/index.html">
    Simulator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../data/index.html">
    Data
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../models/index.html">
    Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../offline/index.html">
    Offline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Online
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../inference/index.html">
    Inference
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../benchmark/index.html">
    Benchmark
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../api/index.html">
    API
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CraftJarvis/MineStudio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/minestudio" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://arxiv.org/pdf/2411.18293" title="ArXiv" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-arxiv fa-lg" aria-hidden="true"></i>
            <span class="sr-only">ArXiv</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
          
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../overview/index.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../overview/getting-started.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../simulator/index.html">
    Simulator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../data/index.html">
    Data
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../models/index.html">
    Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../offline/index.html">
    Offline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Online
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../inference/index.html">
    Inference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../benchmark/index.html">
    Benchmark
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CraftJarvis/MineStudio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/minestudio" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://arxiv.org/pdf/2411.18293" title="ArXiv" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-arxiv fa-lg" aria-hidden="true"></i>
            <span class="sr-only">ArXiv</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview/installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MineStudio Libraries</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../simulator/index.html">Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../simulator/general-information.html">General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulator/design-principles.html">Design Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulator/play.html">Graphical User Interfaces</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../data/index.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/dataset-raw.html">Raw Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/dataset-event.html">Event Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/convertion.html">Data Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/callbacks.html">Data Processing Callbacks</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/baseline-vpt.html">Built-in Models: VPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/baseline-steve1.html">Built-in Models: STEVE-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/baseline-groot.html">Built-in Models: GROOT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/baseline-rocket1.html">Built-in Models: ROCKET-1</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../offline/index.html">Offline Training</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../offline/tutorial-vpt.html">Tutorial: Fine-tuning VPT to a Hunter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../offline/tutorial-rocket.html">Tutorial: Pre-Training ROCKET-1 from Scratch</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Online Training</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="general-information.html">Online Training Module: General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuring Online Training Sessions</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Trainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="rollout.html">Rollout</a></li>
<li class="toctree-l2"><a class="reference internal" href="run.html">Launching Online Training: The <code class="docutils literal notranslate"><span class="pre">run.py</span></code> Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">Shared Utilities for Online Training: The <code class="docutils literal notranslate"><span class="pre">utils</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="customization.html">Customize</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../inference/index.html">Inference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../inference/baseline-vpt.html">Tutorial: Inference with VPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inference/baseline-groot.html">Tutorial: Inference with GROOT</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../benchmark/index.html">Benchmark</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../benchmark/quick-benchmark.html">Quick benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmark/automatic-evaluation.html">Automatic Evaluation Pipeline</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">MineStudio API Documentation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/simulator/index.html">Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/data/index.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/offline/index.html">Offline</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/online/index.html">Online</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/inference/index.html">Inference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../overview/index.html" class="nav-link">Overview</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Online Training</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Trainer</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                   <!--
 * @Date: 2025-03-18 14:36:00
 * @LastEditors: muzhancun muzhancun@stu.pku.edu.cn
 * @LastEditTime: 2025-05-28 16:35:46
 * @FilePath: /MineStudio/docs/source/online/trainer.md
-->
<section id="trainer">
<h1>Trainer<a class="headerlink" href="#trainer" title="Link to this heading">#</a></h1>
<p>This document describes the trainer in the online training module, with the primary implementation being the <code class="docutils literal notranslate"><span class="pre">PPOTrainer</span></code>.</p>
<section id="design-principle">
<h2>Design Principle<a class="headerlink" href="#design-principle" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">PPOTrainer</span></code> (Proximal Policy Optimization Trainer) is the core component responsible for updating the policy and value function models. It leverages the experience data collected by rollout workers and is architected for efficient, distributed training using <code class="docutils literal notranslate"><span class="pre">Ray</span> <span class="pre">Train</span></code>.</p>
<p>The design of the <code class="docutils literal notranslate"><span class="pre">PPOTrainer</span></code> is guided by several key principles. At its heart is the <strong>PPO Algorithm</strong>, a well-regarded actor-critic method in reinforcement learning known for its balance of sample efficiency, stability, and ease of implementation. To handle the demands of large-scale training, the trainer is built for <strong>Distributed Training</strong>, utilizing <code class="docutils literal notranslate"><span class="pre">Ray</span> <span class="pre">Train</span></code> for data parallelism. This enables the training process to scale across multiple GPUs and even multiple nodes in a cluster.</p>
<p>Effective <strong>Data Handling</strong> is crucial. The trainer ingests <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>s (segments of trajectories) from a <code class="docutils literal notranslate"><span class="pre">ReplayBuffer</span></code> (a process managed by its <code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code> parent class). It then computes Generalized Advantage Estimation (GAE) and TD-targets, which are vital for PPO’s policy and value function updates. A <code class="docutils literal notranslate"><span class="pre">data_iter</span></code> is employed to efficiently load and prepare batches of data for the training epochs.</p>
<p><strong>Model Management</strong> encompasses several responsibilities. The trainer initializes the <code class="docutils literal notranslate"><span class="pre">MinePolicy</span></code> model and an AdamW optimizer. It can optionally maintain a separate <code class="docutils literal notranslate"><span class="pre">ref_model</span></code> for KL divergence regularization, which helps stabilize training by penalizing large deviations from a previous policy. Robust model checkpointing capabilities are included, allowing for saving and loading of training progress. Furthermore, updated model weights are periodically broadcast to the rollout workers to ensure they are using the latest policy for experience collection.</p>
<p>The <strong>Loss Calculation</strong> in PPO is a composite objective. This typically includes:</p>
<ul class="simple">
<li><p>A <strong>Policy Loss</strong>, based on a clipped surrogate objective to ensure stable policy updates.</p></li>
<li><p>A <strong>Value Function Loss</strong>, usually a mean squared error to train the value function, which can also be clipped.</p></li>
<li><p>An optional <strong>Entropy Bonus</strong>, added to the loss to encourage exploration by discouraging the policy from becoming too deterministic too quickly, as stated in Soft Actor-Critic (SAC) literature.</p></li>
<li><p>An optional <strong>KL Divergence Penalty</strong>, based on the KL divergence between the current policy and the <code class="docutils literal notranslate"><span class="pre">ref_model</span></code>.</p></li>
</ul>
<p>To aid convergence, the trainer supports <strong>Learning Rate Scheduling</strong>, often in the form of linear annealing. <strong>Gradient Management</strong> techniques are also incorporated, such as gradient accumulation (to simulate larger batch sizes) and gradient norm clipping (to prevent exploding gradients). Finally, comprehensive <strong>Logging and Monitoring</strong> are achieved using <code class="docutils literal notranslate"><span class="pre">wandb_logger</span></code> for Weights &amp; Biases integration and <code class="docutils literal notranslate"><span class="pre">torchmetrics</span></code> for accumulating various performance statistics.</p>
</section>
<section id="logic">
<h2>Logic<a class="headerlink" href="#logic" title="Link to this heading">#</a></h2>
<p>The training process orchestrated by the <code class="docutils literal notranslate"><span class="pre">PPOTrainer</span></code> unfolds in several key stages:</p>
<section id="initialization">
<h3>1. Initialization<a class="headerlink" href="#initialization" title="Link to this heading">#</a></h3>
<p>The journey begins with the setup phase, primarily within the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> and <code class="docutils literal notranslate"><span class="pre">setup_model_and_optimizer</span></code> methods. First, all necessary <strong>Hyperparameters</strong> for the PPO algorithm, optimizer settings, batch sizes, and the training schedule are configured.</p>
<p>Following this, the <strong>Model and Optimizer are Instantiated</strong>. This involves creating the primary policy model (an instance of <code class="docutils literal notranslate"><span class="pre">MinePolicy</span></code>) and initializing the AdamW optimizer with the configured learning rate and weight decay.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">zero_initial_vf</span></code> option is enabled, the weights of the value function head within the policy model are explicitly initialized to zero. This technique can sometimes provide a better starting point for the value function in the early stages of training.</p>
</div>
<p>If KL divergence regularization is active (i.e., <code class="docutils literal notranslate"><span class="pre">kl_divergence_coef_rho</span></code> is non-zero), a separate <strong>Reference Model (<code class="docutils literal notranslate"><span class="pre">ref_model</span></code>) is also set up</strong>. This model typically holds an older version of the policy and serves as a baseline for the KL penalty. Lastly, the model is prepared for <strong>Distributed Setup</strong> with <code class="docutils literal notranslate"><span class="pre">Ray</span> <span class="pre">Train</span></code>, which usually involves wrapping it with <code class="docutils literal notranslate"><span class="pre">torch.nn.parallel.DistributedDataParallel</span></code> if multiple GPUs or nodes are part of the training cluster.</p>
</section>
<section id="main-training-loop">
<h3>2. Main Training Loop<a class="headerlink" href="#main-training-loop" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">train</span></code> method orchestrates the overarching training loop. This loop <strong>Iterates</strong> for a predefined <code class="docutils literal notranslate"><span class="pre">num_iterations</span></code>. Within each iteration, if <strong>Learning Rate Annealing</strong> (<code class="docutils literal notranslate"><span class="pre">anneal_lr_linearly</span></code>) is enabled, the learning rate for the optimizer is adjusted, typically decreased linearly as training progresses. The core work of data processing and model updates for each cycle happens within the <code class="docutils literal notranslate"><span class="pre">train_iteration</span></code> method.</p>
<p>A critical aspect of distributed training is <strong>Model Broadcasting</strong>. This is typically handled by the rank 0 worker (the chief worker). After an initial <code class="docutils literal notranslate"><span class="pre">vf_warmup</span></code> period (during which the value function might be trained more aggressively or exclusively to stabilize it), the updated model weights are broadcast to all rollout workers. This synchronization is facilitated by the <code class="docutils literal notranslate"><span class="pre">broadcast_model_to_rollout_workers</span></code> method, often part of the <code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code> class, ensuring that data collection agents are working with the most up-to-date policy.</p>
</section>
<section id="single-training-iteration">
<h3>3. Single Training Iteration<a class="headerlink" href="#single-training-iteration" title="Link to this heading">#</a></h3>
<p>Each call to the <code class="docutils literal notranslate"><span class="pre">train_iteration</span></code> method performs one complete pass of training. It begins with <strong>Data Acquisition and Preprocessing</strong>. The <code class="docutils literal notranslate"><span class="pre">fetch_fragments_and_estimate_advantages</span></code> method (inherited or called from <code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code>) is invoked. This is a crucial step that retrieves a collection of <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>s from the replay buffer, computes Generalized Advantage Estimation (GAE) values, and calculates TD-lambda targets for value function training.</p>
<p>Once the data is prepared and advantages are estimated, the <strong>PPO Update Execution</strong> commences by calling the <code class="docutils literal notranslate"><span class="pre">ppo_update</span></code> method with this processed information. Additionally, if a KL divergence penalty is used, its coefficient (<code class="docutils literal notranslate"><span class="pre">kl_divergence_coef_rho</span></code>) is decayed according to <code class="docutils literal notranslate"><span class="pre">coef_rho_decay</span></code>, often to gradually reduce its influence as training stabilizes.</p>
</section>
<section id="ppo-update-step">
<h3>4. PPO Update Step<a class="headerlink" href="#ppo-update-step" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ppo_update</span></code> method is where the core PPO algorithm refines the model parameters. This process itself has several sub-stages. The update iterates for a specified number of <strong>Epochs</strong> (<code class="docutils literal notranslate"><span class="pre">epochs_per_iteration</span></code>) over the currently collected batch of data. Within each epoch, a <code class="docutils literal notranslate"><span class="pre">data_iter</span></code> provides <strong>Mini-Batches</strong> of <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>s.</p>
<p>For each mini-batch, several operations occur during <strong>Mini-Batch Processing</strong>. First, <code class="docutils literal notranslate"><span class="pre">prepare_batch</span></code> converts the list of <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>s into a batched PyTorch tensor format, making it suitable for feeding into the neural network. Data is often processed in fixed-length temporal chunks, defined by <code class="docutils literal notranslate"><span class="pre">context_length</span></code>.</p>
<p>The heart of the update is the <strong>Forward Pass</strong>. The current policy model processes the data chunk to obtain new action log probabilities (<code class="docutils literal notranslate"><span class="pre">new_logp</span></code>) for the actions taken in the fragments, value predictions (<code class="docutils literal notranslate"><span class="pre">vpred</span></code>), and the raw policy logits. If KL regularization is active, the <code class="docutils literal notranslate"><span class="pre">ref_model</span></code> also performs a forward pass on the same data to get its corresponding action log probabilities or logits.</p>
<p>Next comes the <strong>Loss Calculation</strong>. The PPO objective is a composite of several terms:</p>
<ul class="simple">
<li><p><strong>Policy Loss (Actor Loss)</strong>: This is calculated using the PPO clipped surrogate objective. It involves computing the probability ratio $r_t(\theta) = \exp(\log \pi_\theta(a_t|s_t) - \log \pi_{\theta_old}(a_t|s_t))$. The loss is then derived from $\min(r_t(\theta)\hat{A}_t, \mathrm{clip}(r_t(\theta), 1-\epsilon, 1+\epsilon)\hat{A}_t)<code class="docutils literal notranslate"><span class="pre">,</span> <span class="pre">where</span> </code>\hat{A}_t` is the advantage estimate. This clipping mechanism is key to PPO’s stability.</p></li>
<li><p><strong>Value Loss (Critic Loss)</strong>: This is typically the Mean Squared Error (MSE) between the predicted values (<code class="docutils literal notranslate"><span class="pre">vpred</span></code>) and the calculated TD-targets. The value loss can also be clipped (if <code class="docutils literal notranslate"><span class="pre">clip_vloss</span></code> is true) by comparing it to a version where value predictions are clipped around the <code class="docutils literal notranslate"><span class="pre">old_vpred</span></code> from the previous iteration.</p></li>
<li><p><strong>Entropy Bonus</strong>: An entropy term, derived from the policy logits, is added to the objective. This encourages exploration by penalizing policies that become too deterministic too quickly.</p></li>
<li><p><strong>KL Divergence Loss</strong>: If enabled, this measures the KL divergence between the current policy’s action distribution and that of the <code class="docutils literal notranslate"><span class="pre">ref_model</span></code>. It acts as an additional regularization term.
The <strong>Total Loss</strong> is then a weighted sum of these components.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>During an initial <code class="docutils literal notranslate"><span class="pre">vf_warmup</span></code> phase, the training might focus more on the value function. In such cases, the total loss might be dominated by, or solely consist of, the value function loss (and KL loss if active). This helps in stabilizing the value estimates before the policy is trained more aggressively.</p>
</div>
<p>With the total loss computed, the <strong>Backward Pass and Optimization</strong> step follows. The <code class="docutils literal notranslate"><span class="pre">total_loss</span></code> is backpropagated to compute gradients. If <strong>Gradient Accumulation</strong> is used (i.e., <code class="docutils literal notranslate"><span class="pre">gradient_accumulation</span></code> &gt; 1), gradients are summed over several mini-batches before an optimizer step is taken, effectively simulating a larger batch size which can sometimes stabilize training. <strong>Gradient Clipping</strong> is then applied, where gradients are clipped to a maximum norm (<code class="docutils literal notranslate"><span class="pre">max_grad_norm</span></code>) using <code class="docutils literal notranslate"><span class="pre">torch.nn.utils.clip_grad_norm_</span></code>. This is a common technique to prevent issues with exploding gradients. Finally, the optimizer (e.g., AdamW) updates the model parameters using these accumulated and clipped gradients.</p>
<p>Throughout this PPO update cycle, various <strong>Metrics are Aggregated</strong>. These include individual loss components, the approximate KL divergence between the old and new policies, the fraction of samples where the PPO clipping was active, and explained variance. These metrics are computed and tracked using <code class="docutils literal notranslate"><span class="pre">torchmetrics</span></code>.</p>
</section>
<section id="logging-and-checkpointing">
<h3>5. Logging and Checkpointing<a class="headerlink" href="#logging-and-checkpointing" title="Link to this heading">#</a></h3>
<p>Essential for monitoring and recovery, logging and checkpointing operations are typically performed by the rank 0 worker. After each <code class="docutils literal notranslate"><span class="pre">ppo_update</span></code> (meaning, after all epochs for a given batch of data have been processed), the aggregated training <strong>Metrics are Logged</strong> using <code class="docutils literal notranslate"><span class="pre">wandb_logger</span></code>. This sends the data to Weights &amp; Biases, allowing for real-time monitoring and later analysis of the training run.</p>
<p><strong>Model Checkpointing</strong> is performed periodically. The state of the model (its weights), the optimizer’s state, and the current number of updates are saved to disk. The frequency of these saves is governed by <code class="docutils literal notranslate"><span class="pre">save_interval</span></code>, and <code class="docutils literal notranslate"><span class="pre">save_path</span></code> specifies the directory for these checkpoints. To manage disk space, <strong>Old Checkpoint Management</strong> ensures that older checkpoints are removed based on the <code class="docutils literal notranslate"><span class="pre">keep_interval</span></code>, for instance, by keeping only the last N checkpoints.</p>
</section>
<section id="reference-model-update">
<h3>6. Reference Model Update<a class="headerlink" href="#reference-model-update" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">_update_ref_model</span></code> method is responsible for the synchronization of the reference model, which is used when KL regularization is active. If <code class="docutils literal notranslate"><span class="pre">enable_ref_update</span></code> is true, the weights of the <code class="docutils literal notranslate"><span class="pre">ref_model</span></code> are periodically updated to match the weights of the current trained policy model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This update of the reference model is often coordinated with the <code class="docutils literal notranslate"><span class="pre">broadcast_model_to_rollout_workers</span></code> calls. This ensures the reference policy doesn’t lag too far behind the current policy, yet doesn’t update too frequently, which could diminish its regularizing effect by making it too similar to the current policy.</p>
</div>
<p>This comprehensive cycle of data ingestion, advantage estimation, policy optimization, and model management continues for the specified <code class="docutils literal notranslate"><span class="pre">num_iterations</span></code>. The ultimate aim is to train an agent that learns to perform effectively and master complex tasks within the Minecraft environment.</p>
</section>
</section>
</section>

<div class="section ablog__blog_comments">
   
</div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="config.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Configuring Online Training Sessions</p>
      </div>
    </a>
    <a class="right-next"
       href="rollout.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Rollout</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-principle">Design Principle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logic">Logic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization">1. Initialization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#main-training-loop">2. Main Training Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-training-iteration">3. Single Training Iteration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ppo-update-step">4. PPO Update Step</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging-and-checkpointing">5. Logging and Checkpointing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reference-model-update">6. Reference Model Update</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/online/trainer.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, The CraftJarvis Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>