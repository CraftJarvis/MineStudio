
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Shared Utilities for Online Training: The utils Module &#8212; MineStudio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d6734ac8" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=00f267c6"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'online/utils';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://craftjarvis.github.io/MineStudio/_static/version.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'latest';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <script defer="defer" src="../_static/custom-icons.js?v=26a3f3bc"></script>
    <link rel="icon" href="../_static/logo-no-text-light.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Customize" href="customization.html" />
    <link rel="prev" title="Launching Online Training: The run.py Script" href="run.html" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />   
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-no-text-light.svg" class="logo__image only-light" alt=""/>
    <img src="../_static/logo-no-text-light.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">MineStudio</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../overview/index.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../overview/getting-started.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../simulator/index.html">
    Simulator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../data/index.html">
    Data
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../models/index.html">
    Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../offline/index.html">
    Offline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Online
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../inference/index.html">
    Inference
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../benchmark/index.html">
    Benchmark
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../api/index.html">
    API
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CraftJarvis/MineStudio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/minestudio" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://arxiv.org/pdf/2411.18293" title="ArXiv" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-arxiv fa-lg" aria-hidden="true"></i>
            <span class="sr-only">ArXiv</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
          
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../overview/index.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../overview/getting-started.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../simulator/index.html">
    Simulator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../data/index.html">
    Data
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../models/index.html">
    Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../offline/index.html">
    Offline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Online
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../inference/index.html">
    Inference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../benchmark/index.html">
    Benchmark
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CraftJarvis/MineStudio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/minestudio" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://arxiv.org/pdf/2411.18293" title="ArXiv" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-arxiv fa-lg" aria-hidden="true"></i>
            <span class="sr-only">ArXiv</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview/installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MineStudio Libraries</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../simulator/index.html">Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../simulator/general-information.html">General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulator/design-principles.html">Design Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulator/play.html">Graphical User Interfaces</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../data/index.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/dataset-raw.html">Raw Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/dataset-event.html">Event Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/convertion.html">Data Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/callbacks.html">Data Processing Callbacks</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/baseline-vpt.html">Built-in Models: VPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/baseline-steve1.html">Built-in Models: STEVE-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/baseline-groot.html">Built-in Models: GROOT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/baseline-rocket1.html">Built-in Models: ROCKET-1</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../offline/index.html">Offline Training</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../offline/tutorial-vpt.html">Tutorial: Fine-tuning VPT to a Hunter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../offline/tutorial-rocket.html">Tutorial: Pre-Training ROCKET-1 from Scratch</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Online Training</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="general-information.html">Online Training Module: General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuring Online Training Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="trainer.html">Trainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="rollout.html">Rollout</a></li>
<li class="toctree-l2"><a class="reference internal" href="run.html">Launching Online Training: The <code class="docutils literal notranslate"><span class="pre">run.py</span></code> Script</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Shared Utilities for Online Training: The <code class="docutils literal notranslate"><span class="pre">utils</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="customization.html">Customize</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../inference/index.html">Inference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../inference/baseline-vpt.html">Tutorial: Inference with VPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inference/baseline-groot.html">Tutorial: Inference with GROOT</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../benchmark/index.html">Benchmark</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../benchmark/quick-benchmark.html">Quick benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmark/automatic-evaluation.html">Automatic Evaluation Pipeline</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">MineStudio API Documentation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/simulator/index.html">Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/data/index.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/offline/index.html">Offline</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/online/index.html">Online</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/inference/index.html">Inference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../overview/index.html" class="nav-link">Overview</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Online Training</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Shared Utilities for Online Training: The <code class="docutils literal notranslate"><span class="pre">utils</span></code> Module</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                   <!-- filepath: /Users/muzhancun/workspace/MineStudio/docs/source/online/utils.md -->
<section id="shared-utilities-for-online-training-the-utils-module">
<h1>Shared Utilities for Online Training: The <code class="docutils literal notranslate"><span class="pre">utils</span></code> Module<a class="headerlink" href="#shared-utilities-for-online-training-the-utils-module" title="Link to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/</span></code> directory is a crucial part of the online training module, housing a collection of common utilities, data structures, and helper functions. These components are designed to support both the data collection (rollout) and model optimization (trainer) phases, fostering code reusability, modularity, and a consistent design philosophy across the entire online training pipeline.</p>
<section id="design-philosophy-centralized-support">
<h2>Design Philosophy: Centralized Support<a class="headerlink" href="#design-philosophy-centralized-support" title="Link to this heading">#</a></h2>
<p>The primary goal of the <code class="docutils literal notranslate"><span class="pre">utils</span></code> module is to abstract away common, repetitive tasks and provide robust, well-tested solutions that can be leveraged by different parts of the online learning system. By centralizing these functionalities, the main <code class="docutils literal notranslate"><span class="pre">rollout</span></code> and <code class="docutils literal notranslate"><span class="pre">trainer</span></code> code can remain focused on their core responsibilities, leading to cleaner, more maintainable, and easier-to-understand implementations.</p>
<p>The utilities are thoughtfully organized, often categorized into sub-modules that cater specifically to the needs of <code class="docutils literal notranslate"><span class="pre">rollout</span></code> operations or <code class="docutils literal notranslate"><span class="pre">train</span></code> operations, alongside more general-purpose tools.</p>
</section>
<section id="key-components-and-their-roles">
<h2>Key Components and Their Roles<a class="headerlink" href="#key-components-and-their-roles" title="Link to this heading">#</a></h2>
<p>Let’s explore the important sub-directories and files within <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/</span></code>:</p>
<section id="supporting-the-rollout-process-minestudio-online-utils-rollout">
<h3>Supporting the Rollout Process: <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/rollout/</span></code><a class="headerlink" href="#supporting-the-rollout-process-minestudio-online-utils-rollout" title="Link to this heading">#</a></h3>
<p>This sub-directory is dedicated to utilities that facilitate the efficient collection and management of experience data from the agent-environment interactions.</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datatypes.py</span></code>: Defining the Language of Experience</strong>
This file is fundamental as it defines the core data structures used to represent the agent’s experiences:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">StepRecord</span></code>: Think of this as a snapshot of a single moment in the environment. It meticulously records all relevant information for one step taken by the agent, including the observation received, the action performed, the reward obtained, whether the episode terminated (done state), the version of the model that chose the action, and potentially other diagnostic information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>: This structure bundles a sequence of <code class="docutils literal notranslate"><span class="pre">StepRecord</span></code>s, forming a coherent segment of a trajectory (a snippet of an episode). It typically includes batched observations, actions, rewards, and done flags from consecutive steps. Importantly, it also often stores the initial hidden states of recurrent neural networks (if used by the policy) for this segment and associated metadata.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FragmentMetadata</span></code>: Contains contextual information about a <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>, such as a unique session identifier, the version of the policy model used to generate the data, and identifiers for the worker process that collected it. This metadata is crucial for debugging, analysis, and ensuring data integrity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FragmentIndex</span></code>: A unique key or identifier assigned to each <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code> when it’s stored, for example, in a replay buffer. This allows for efficient retrieval and management of specific data chunks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FragmentDataDict</span></code>: A specialized dictionary-like container designed for performance. It efficiently stores and allows quick access to auxiliary data (like calculated advantages or TD-targets for policy gradient methods) that is associated with <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>s, typically using the <code class="docutils literal notranslate"><span class="pre">FragmentIndex</span></code> as the key.</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">monitor.py</span></code>: Keeping an Eye on Performance</strong>
Monitoring the health and efficiency of the rollout process is vital:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">MovingStat</span></code>: A handy class for calculating moving averages and other statistical measures (like standard deviation) over a sliding window of data. This is useful for tracking metrics like rewards or episode lengths in a smoothed manner.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PipelineMonitor</span></code>: This utility is designed for performance profiling of sequential operations. For instance, within a <code class="docutils literal notranslate"><span class="pre">RolloutWorker</span></code>, it can track the time spent in different stages of its main loop, such as receiving observations from the environment (<code class="docutils literal notranslate"><span class="pre">recv_obs</span></code>), performing model inference (<code class="docutils literal notranslate"><span class="pre">inference</span></code>), and sending actions back (<code class="docutils literal notranslate"><span class="pre">send_action</span></code>). This helps pinpoint bottlenecks in the data collection pipeline.</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">get_rollout_manager.py</span></code> (Conceptual): Accessing the Conductor</strong>
While the exact implementation might vary, this module (or a similar utility) would typically provide a standardized function to obtain a handle or reference to the <code class="docutils literal notranslate"><span class="pre">RolloutManager</span></code> Ray actor. This abstracts the details of how the actor is named or retrieved within the Ray ecosystem, providing a clean interface for other components (like the <code class="docutils literal notranslate"><span class="pre">Trainer</span></code>) that need to communicate with it.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code></strong>: As is standard in Python, this file makes the key classes and functions from the <code class="docutils literal notranslate"><span class="pre">utils.rollout</span></code> sub-module easily importable.</p></li>
</ul>
</section>
<section id="assisting-the-training-loop-minestudio-online-utils-train">
<h3>Assisting the Training Loop: <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/train/</span></code><a class="headerlink" href="#assisting-the-training-loop-minestudio-online-utils-train" title="Link to this heading">#</a></h3>
<p>This section provides tools specifically tailored to the needs of the model training and optimization process.</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">data.py</span></code>: Preparing Data for Learning</strong>
Efficiently feeding data to the training algorithm is critical:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">prepare_batch()</span></code>: This function takes a list of <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>s (as collected by the rollout workers) and transforms them into a batch format suitable for input to a PyTorch model. This involves stacking individual data points (observations, actions, rewards, etc.) into larger tensors and correctly handling recurrent hidden states if the policy uses them.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_iter()</span></code>: Creates a sophisticated iterator that can yield batches of <code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code>s. It might draw from a pool of data loaders, potentially managing asynchronous data fetching or prefetching to ensure the GPU is kept busy during distributed training. This is key to achieving high training throughput.</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">training_session.py</span></code>: Managing the Overall Training Context</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TrainingSession</span></code>: Often implemented as a Ray actor, this utility can manage global aspects of an entire training run. For example, it might be responsible for generating unique session IDs (useful for organizing logs and checkpoints), or it could coordinate high-level training progress, aggregate metadata from distributed trainers, or manage global counters.</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">wandb_logger.py</span></code>: Tracking Experiments with Weights &amp; Biases</strong>
Effective experiment tracking is indispensable for research and development. This utility provides a clean interface for logging various metrics and information to Weights &amp; Biases (<code class="docutils literal notranslate"><span class="pre">wandb</span></code>), a popular platform for experiment tracking and visualization:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">define_metric()</span></code>: Allows for pre-defining metrics in <code class="docutils literal notranslate"><span class="pre">wandb</span></code>, specifying things like which metrics should have a summary (e.g., min, max, mean) or how they should be plotted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_metrics()</span></code>: A straightforward function to log a dictionary of key-value pairs (metrics) to <code class="docutils literal notranslate"><span class="pre">wandb</span></code> at a specific training step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_config()</span></code>: Logs the entire training configuration (e.g., the <code class="docutils literal notranslate"><span class="pre">OmegaConf</span></code> object) to <code class="docutils literal notranslate"><span class="pre">wandb</span></code>, ensuring that every run is associated with the exact settings that produced it.</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code></strong>: Exports the essential components from the <code class="docutils literal notranslate"><span class="pre">utils.train</span></code> sub-module.</p></li>
</ul>
</section>
<section id="general-purpose-toolkit-top-level-utilities-in-minestudio-online-utils">
<h3>General-Purpose Toolkit: Top-Level Utilities in <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/</span></code><a class="headerlink" href="#general-purpose-toolkit-top-level-utilities-in-minestudio-online-utils" title="Link to this heading">#</a></h3>
<p>Beyond the specialized sub-modules, the <code class="docutils literal notranslate"><span class="pre">utils</span></code> directory (or its main <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>) often contains or re-exports more broadly applicable helper functions, particularly for data manipulation:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">auto_stack()</span></code></strong>: A powerful utility that can intelligently take a list of (potentially complex and nested) dictionaries or arrays and stack them into batched NumPy arrays or PyTorch tensors. It automatically handles the structure of the data, making it much easier to prepare batches from collected experiences.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">auto_to_numpy()</span></code></strong>: Recursively traverses a nested data structure (e.g., dictionaries of tensors) and converts all PyTorch tensors within it to NumPy arrays.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">auto_to_torch()</span></code></strong>: The counterpart to <code class="docutils literal notranslate"><span class="pre">auto_to_numpy</span></code>. It converts NumPy arrays within a nested structure to PyTorch tensors, with an option to move them to a specified device (e.g., a GPU).</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">auto_slice()</span></code></strong>: Provides a convenient way to slice data (which could be nested dictionaries, tensors, or arrays) along a specified dimension or index range.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">recursive_detach()</span></code></strong>: Traverses a nested structure containing PyTorch tensors and detaches each tensor from its computation graph. This is useful when you want to use the tensor data without backpropagating gradients through it.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>These <code class="docutils literal notranslate"><span class="pre">auto_*</span></code> functions are particularly valuable because they reduce boilerplate code. Dealing with nested structures of data is common in reinforcement learning (e.g., observations might be dictionaries containing multiple types of sensor data), and these utilities handle the recursion and type conversions gracefully.</p>
</div>
<p>In essence, the <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/</span></code> module acts as a shared toolbox, providing well-crafted instruments that simplify common tasks, ensure consistency, and allow the main algorithms for data collection and training to be expressed more clearly and concisely. Its thoughtful organization contributes significantly to the overall robustness and maintainability of the MineStudio online training framework.</p>
</section>
</section>
</section>

<div class="section ablog__blog_comments">
   
</div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="run.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Launching Online Training: The <code class="docutils literal notranslate"><span class="pre">run.py</span></code> Script</p>
      </div>
    </a>
    <a class="right-next"
       href="customization.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Customize</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-philosophy-centralized-support">Design Philosophy: Centralized Support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-components-and-their-roles">Key Components and Their Roles</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supporting-the-rollout-process-minestudio-online-utils-rollout">Supporting the Rollout Process: <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/rollout/</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assisting-the-training-loop-minestudio-online-utils-train">Assisting the Training Loop: <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/train/</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-purpose-toolkit-top-level-utilities-in-minestudio-online-utils">General-Purpose Toolkit: Top-Level Utilities in <code class="docutils literal notranslate"><span class="pre">minestudio/online/utils/</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/online/utils.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, The CraftJarvis Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>