
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Online API Documentation &#8212; MineStudio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=d6734ac8" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=00f267c6"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/online/index';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://craftjarvis.github.io/MineStudio/_static/version.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'latest';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <script defer="defer" src="../../_static/custom-icons.js?v=26a3f3bc"></script>
    <link rel="icon" href="../../_static/logo-no-text-light.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Inference API Documentation" href="../inference/index.html" />
    <link rel="prev" title="Offline API Documentation" href="../offline/index.html" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />   
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-no-text-light.svg" class="logo__image only-light" alt=""/>
    <img src="../../_static/logo-no-text-light.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">MineStudio</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../overview/index.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../overview/getting-started.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../simulator/index.html">
    Simulator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../data/index.html">
    Data
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../models/index.html">
    Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../offline/index.html">
    Offline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../online/index.html">
    Online
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../inference/index.html">
    Inference
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../benchmark/index.html">
    Benchmark
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../index.html">
    API
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CraftJarvis/MineStudio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/minestudio" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://arxiv.org/pdf/2411.18293" title="ArXiv" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-arxiv fa-lg" aria-hidden="true"></i>
            <span class="sr-only">ArXiv</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
          
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../overview/index.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../overview/getting-started.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../simulator/index.html">
    Simulator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../data/index.html">
    Data
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../models/index.html">
    Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../offline/index.html">
    Offline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../online/index.html">
    Online
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../inference/index.html">
    Inference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../benchmark/index.html">
    Benchmark
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    API
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CraftJarvis/MineStudio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/minestudio" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://arxiv.org/pdf/2411.18293" title="ArXiv" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-arxiv fa-lg" aria-hidden="true"></i>
            <span class="sr-only">ArXiv</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../overview/installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MineStudio Libraries</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../simulator/index.html">Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../simulator/general-information.html">General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../simulator/design-principles.html">Design Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../simulator/play.html">Graphical User Interfaces</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../data/index.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../data/dataset-raw.html">Raw Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/dataset-event.html">Event Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/convertion.html">Data Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/callbacks.html">Data Processing Callbacks</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline-vpt.html">Built-in Models: VPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline-steve1.html">Built-in Models: STEVE-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline-groot.html">Built-in Models: GROOT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline-rocket1.html">Built-in Models: ROCKET-1</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../offline/index.html">Offline Training</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../offline/tutorial-vpt.html">Tutorial: Fine-tuning VPT to a Hunter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../offline/tutorial-rocket.html">Tutorial: Pre-Training ROCKET-1 from Scratch</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../online/index.html">Online Training</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../online/general-information.html">Online Training Module: General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/config.html">Configuring Online Training Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/trainer.html">Trainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/rollout.html">Rollout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/run.html">Launching Online Training: The <code class="docutils literal notranslate"><span class="pre">run.py</span></code> Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/utils.html">Shared Utilities for Online Training: The <code class="docutils literal notranslate"><span class="pre">utils</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/customization.html">Customize</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../inference/index.html">Inference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../inference/baseline-vpt.html">Tutorial: Inference with VPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../inference/baseline-groot.html">Tutorial: Inference with GROOT</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../benchmark/index.html">Benchmark</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../benchmark/quick-benchmark.html">Quick benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../benchmark/automatic-evaluation.html">Automatic Evaluation Pipeline</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">MineStudio API Documentation</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../simulator/index.html">Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../data/index.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../offline/index.html">Offline</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="current reference internal" href="#">Online</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../inference/index.html">Inference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../overview/index.html" class="nav-link">Overview</a></li>
    
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">MineStudio API Documentation</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Online API Documentation</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                   <section id="online-api-documentation">
<h1>Online API Documentation<a class="headerlink" href="#online-api-documentation" title="Link to this heading">#</a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="rollout">
<h2>Rollout<a class="headerlink" href="#rollout" title="Link to this heading">#</a></h2>
<section id="module-minestudio.online.rollout.env_worker">
<span id="env-worker"></span><h3>Env Worker<a class="headerlink" href="#module-minestudio.online.rollout.env_worker" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.EnvWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.env_worker.</span></span><span class="sig-name descname"><span class="pre">EnvWorker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env_generator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../simulator/index.html#minestudio.simulator.entry.MinecraftSim" title="minestudio.simulator.entry.MinecraftSim"><span class="pre">MinecraftSim</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Connection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">video_output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">video_fps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restart_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_fast_reset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rollout_worker_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#EnvWorker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.EnvWorker" title="Link to this definition">#</a></dt>
<dd><p>A class for running a Minecraft simulation environment in a separate process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>env_generator</strong> – A function that returns a MinecraftSim instance.</p></li>
<li><p><strong>conn</strong> – A multiprocessing connection object for communication with the main process.</p></li>
<li><p><strong>video_output_dir</strong> – The directory to save output videos to.</p></li>
<li><p><strong>video_fps</strong> – The frames per second for output videos.</p></li>
<li><p><strong>restart_interval</strong> – The interval in seconds after which to restart the environment.</p></li>
<li><p><strong>max_fast_reset</strong> – The maximum number of fast resets to perform.</p></li>
<li><p><strong>env_id</strong> – The ID of the environment.</p></li>
<li><p><strong>rollout_worker_id</strong> – The ID of the rollout worker.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.EnvWorker.report_rewards">
<span class="sig-name descname"><span class="pre">report_rewards</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rewards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#EnvWorker.report_rewards"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.EnvWorker.report_rewards" title="Link to this definition">#</a></dt>
<dd><p>Sends the rewards for an episode to the main process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rewards</strong> – A NumPy array of rewards for the episode.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The result from the main process.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.EnvWorker.reset_state">
<span class="sig-name descname"><span class="pre">reset_state</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#EnvWorker.reset_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.EnvWorker.reset_state" title="Link to this definition">#</a></dt>
<dd><p>Sends a reset signal to the main process and receives the initial observation.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The initial observation from the environment.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.EnvWorker.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#EnvWorker.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.EnvWorker.run" title="Link to this definition">#</a></dt>
<dd><p>The main loop of the environment worker process.
Handles environment resets, steps, and video recording.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.EnvWorker.step_agent">
<span class="sig-name descname"><span class="pre">step_agent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_terminated</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_truncated</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">episode_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#EnvWorker.step_agent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.EnvWorker.step_agent" title="Link to this definition">#</a></dt>
<dd><p>Sends an observation to the main process and receives an action and predicted value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> – The current observation from the environment.</p></li>
<li><p><strong>last_reward</strong> – The reward from the previous step.</p></li>
<li><p><strong>last_terminated</strong> – Whether the previous episode terminated.</p></li>
<li><p><strong>last_truncated</strong> – Whether the previous episode was truncated.</p></li>
<li><p><strong>episode_uuid</strong> – The UUID of the current episode.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the action and predicted value.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.VideoWriter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.env_worker.</span></span><span class="sig-name descname"><span class="pre">VideoWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">video_fps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queue_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">200</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#VideoWriter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.VideoWriter" title="Link to this definition">#</a></dt>
<dd><p>A class for writing video frames to a file in a separate thread.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>video_fps</strong> – The frames per second of the output video.</p></li>
<li><p><strong>queue_size</strong> – The maximum size of the command queue.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.VideoWriter.close_video">
<span class="sig-name descname"><span class="pre">close_video</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#VideoWriter.close_video"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.VideoWriter.close_video" title="Link to this definition">#</a></dt>
<dd><p>Closes the current video file.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.VideoWriter.open_video">
<span class="sig-name descname"><span class="pre">open_video</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PosixPath</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#VideoWriter.open_video"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.VideoWriter.open_video" title="Link to this definition">#</a></dt>
<dd><p>Opens a video file for writing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> – The path to the video file.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – if a video is already open.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.VideoWriter.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#VideoWriter.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.VideoWriter.run" title="Link to this definition">#</a></dt>
<dd><p>The main loop of the video writer thread.
Processes commands from the queue to open, write, and close video files.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.VideoWriter.write_frame">
<span class="sig-name descname"><span class="pre">write_frame</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#VideoWriter.write_frame"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.VideoWriter.write_frame" title="Link to this definition">#</a></dt>
<dd><p>Writes a frame to the video file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>frame</strong> – The frame to write, as a NumPy array.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – if no video is open.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.rollout.env_worker.draw_vpred">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.env_worker.</span></span><span class="sig-name descname"><span class="pre">draw_vpred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vpred</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">additional_text</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/env_worker.html#draw_vpred"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.env_worker.draw_vpred" title="Link to this definition">#</a></dt>
<dd><p>Draws the predicted value (vpred) and additional text on an image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> – The input image as a NumPy array.</p></li>
<li><p><strong>vpred</strong> – The predicted value to display.</p></li>
<li><p><strong>additional_text</strong> – Optional additional text to display.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The image with the text drawn on it.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-minestudio.online.rollout.episode_statistics">
<span id="episode-statistics"></span><h3>Episode Statistics<a class="headerlink" href="#module-minestudio.online.rollout.episode_statistics" title="Link to this heading">#</a></h3>
</section>
<section id="module-minestudio.online.rollout.rollout_manager">
<span id="rollout-manager"></span><h3>Rollout Manager<a class="headerlink" href="#module-minestudio.online.rollout.rollout_manager" title="Link to this heading">#</a></h3>
</section>
<section id="module-minestudio.online.rollout.rollout_worker">
<span id="rollout-worker"></span><h3>Rollout Worker<a class="headerlink" href="#module-minestudio.online.rollout.rollout_worker" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.ProgressHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.rollout_worker.</span></span><span class="sig-name descname"><span class="pre">ProgressHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#ProgressHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.ProgressHandler" title="Link to this definition">#</a></dt>
<dd><p>A protocol defining the structure for a progress handler function.</p>
<p>This handler is called by the RolloutWorker to report step-wise progress.
Implementers of this protocol can use this to, for example, send data to a replay buffer.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.RolloutWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.rollout_worker.</span></span><span class="sig-name descname"><span class="pre">RolloutWorker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_envs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy_generator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../models/index.html#minestudio.models.base_policy.MinePolicy" title="minestudio.models.base_policy.MinePolicy"><span class="pre">MinePolicy</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_generator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../simulator/index.html#minestudio.simulator.entry.MinecraftSim" title="minestudio.simulator.entry.MinecraftSim"><span class="pre">MinecraftSim</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_normalized_vf</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_model_version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">video_fps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">video_output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'./output'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resume</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restart_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moving_stat_duration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">episode_statistics</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ActorHandle</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progress_handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.rollout.rollout_worker.ProgressHandler" title="minestudio.online.rollout.rollout_worker.ProgressHandler"><span class="pre">ProgressHandler</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_fast_reset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rollout_worker_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#RolloutWorker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.RolloutWorker" title="Link to this definition">#</a></dt>
<dd><p>Manages a set of environments and a policy to collect experience for reinforcement learning.</p>
<p>This class is responsible for:
- Spawning and managing multiple environment worker processes (EnvWorker).
- Performing inference using the policy model.
- Stepping through the environments and collecting observations, actions, rewards, etc.
- Communicating with an EpisodeStatistics actor to report episode-level metrics.
- Optionally calling a progress_handler to process step-wise data (e.g., for a replay buffer).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_envs</strong> – The number of parallel environments to run.</p></li>
<li><p><strong>policy_generator</strong> – A callable that returns an instance of MinePolicy (the policy model).</p></li>
<li><p><strong>env_generator</strong> – A callable that returns an instance of MinecraftSim (the environment).</p></li>
<li><p><strong>use_normalized_vf</strong> – Whether to use a normalized value function. If True, vpreds will be denormalized.</p></li>
<li><p><strong>model_device</strong> – The device to run the policy model on (e.g., “cpu”, “cuda:0”).</p></li>
<li><p><strong>next_model_version</strong> – The initial version of the model.</p></li>
<li><p><strong>batch_size</strong> – The number of environment steps to batch together for inference.</p></li>
<li><p><strong>video_fps</strong> – Frames per second for video recording in EnvWorker.</p></li>
<li><p><strong>video_output_dir</strong> – Directory to save videos in EnvWorker.</p></li>
<li><p><strong>resume</strong> – Optional path to a checkpoint to resume training from.</p></li>
<li><p><strong>restart_interval</strong> – Optional interval in seconds after which to restart EnvWorkers.</p></li>
<li><p><strong>moving_stat_duration</strong> – Duration in seconds for calculating moving statistics (e.g., for pipeline monitoring).</p></li>
<li><p><strong>log_interval</strong> – Optional interval in seconds for logging pipeline monitoring stats.</p></li>
<li><p><strong>episode_statistics</strong> – Optional Ray ActorHandle for an EpisodeStatistics actor.</p></li>
<li><p><strong>progress_handler</strong> – Optional callable that conforms to the ProgressHandler protocol.</p></li>
<li><p><strong>max_fast_reset</strong> – Maximum number of fast resets for an EnvWorker before a full restart.</p></li>
<li><p><strong>rollout_worker_id</strong> – Identifier for this rollout worker.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.RolloutWorker.inference">
<span class="sig-name descname"><span class="pre">inference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">requests</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#RolloutWorker.inference"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.inference" title="Link to this definition">#</a></dt>
<dd><p>Performs a batch of inference requests using the policy model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>requests</strong> – A list of tuples, where each tuple contains (worker_id, observation).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing:
- result_actions: A list of actions for each request.
- result_states: A list of next hidden states for each request.
- result_vpreds: A list of predicted values (vpreds) for each request.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.RolloutWorker.load_weights">
<span class="sig-name descname"><span class="pre">load_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#RolloutWorker.load_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.load_weights" title="Link to this definition">#</a></dt>
<dd><p>Loads new weights into the policy model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>weights</strong> – A dictionary containing the state dictionary of the model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.RolloutWorker.loop">
<span class="sig-name descname"><span class="pre">loop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#RolloutWorker.loop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.loop" title="Link to this definition">#</a></dt>
<dd><p>Runs one iteration of the rollout loop.</p>
<p>This involves:
1. Polling environments until enough requests are queued to fill a batch.
2. Performing inference on the batch of requests.
3. Sending actions back to the environments.
4. Calling the progress_handler if it’s set.
5. Polling environments again to process any immediate responses.
6. Logging statistics if the log_interval is met.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.RolloutWorker.poll_environments">
<span class="sig-name descname"><span class="pre">poll_environments</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#RolloutWorker.poll_environments"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.poll_environments" title="Link to this definition">#</a></dt>
<dd><p>Polls all environment connections for messages and processes them.</p>
<p>Handles different message types:
- “step_agent”: An environment is ready for a new action. The observation is added to queued_requests.
- “reset_state”: An environment has reset. The agent’s hidden state for this environment is reset.
- “report_rewards”: An environment has finished an episode. Rewards are reported to EpisodeStatistics.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.RolloutWorker.progress_handler">
<span class="sig-name descname"><span class="pre">progress_handler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">worker_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_spec</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_terminated</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_truncated</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">episode_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#RolloutWorker.progress_handler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.progress_handler" title="Link to this definition">#</a></dt>
<dd><p>Default progress handler, likely intended to be overridden or replaced.
This implementation seems to be a duplicate of logic within RolloutWorkerWrapper.progress_handler
and might not be used if a custom progress_handler is provided during RolloutWorker initialization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>worker_uuid</strong> – The UUID of the worker environment.</p></li>
<li><p><strong>obs</strong> – The observation from the environment.</p></li>
<li><p><strong>env_spec</strong> – Specification of the environment, used for filtering.</p></li>
<li><p><strong>state</strong> – The hidden state of the policy model.</p></li>
<li><p><strong>action</strong> – The action taken by the policy.</p></li>
<li><p><strong>last_reward</strong> – The reward received from the previous step.</p></li>
<li><p><strong>last_terminated</strong> – Whether the episode terminated at the previous step.</p></li>
<li><p><strong>last_truncated</strong> – Whether the episode was truncated at the previous step.</p></li>
<li><p><strong>episode_uuid</strong> – The UUID of the current episode.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – if env_spec is not in self.env_spec.config4test when not in self.env_spec.config.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.RolloutWorker.rollout">
<span class="sig-name descname"><span class="pre">rollout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_batches</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#RolloutWorker.rollout"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.rollout" title="Link to this definition">#</a></dt>
<dd><p>Runs the rollout loop for a specified number of batches.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>num_batches</strong> – The number of inference batches to collect.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.rollout_worker.RolloutWorker.update_model_version">
<span class="sig-name descname"><span class="pre">update_model_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">next_model_version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/rollout_worker.html#RolloutWorker.update_model_version"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.update_model_version" title="Link to this definition">#</a></dt>
<dd><p>Updates the model version number that will be associated with subsequently collected data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>next_model_version</strong> – The new model version number.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-minestudio.online.rollout.start_manager">
<span id="start-manager"></span><h3>Start Manager<a class="headerlink" href="#module-minestudio.online.rollout.start_manager" title="Link to this heading">#</a></h3>
<p>Date: 2025-05-22 21:43:52
LastEditors: caishaofei-mus1 <a class="reference external" href="mailto:1744260356&#37;&#52;&#48;qq&#46;com">1744260356<span>&#64;</span>qq<span>&#46;</span>com</a>
LastEditTime: 2025-05-23 11:39:21
FilePath: /MineStudio/var/minestudio/online/rollout/start_manager.py</p>
<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.rollout.start_manager.start_rolloutmanager">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.start_manager.</span></span><span class="sig-name descname"><span class="pre">start_rolloutmanager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy_generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">online_cfg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">address</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'localhost:9899'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/start_manager.html#start_rolloutmanager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.start_manager.start_rolloutmanager" title="Link to this definition">#</a></dt>
<dd><p>Initializes and starts a RolloutManager actor in a Ray cluster.</p>
<p>This function handles the creation or reuse of a RolloutManager actor.
If a RolloutManager with the name “rollout_manager” already exists, it checks if its
configuration matches the provided <cite>online_cfg</cite>. If the configurations differ,
the existing actor is killed, and a new one is created. Otherwise, the existing
actor is reused.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>policy_generator</strong> – A callable that generates a policy model.</p></li>
<li><p><strong>env_generator</strong> – A callable that generates a Minecraft simulation environment.</p></li>
<li><p><strong>online_cfg</strong> – An OmegaConf DictConfig object containing the online training configuration.
This includes sub-configs for <cite>train_config</cite> and <cite>rollout_config</cite>.</p></li>
<li><p><strong>address</strong> – The address of the Ray cluster to connect to.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="replay-buffer">
<h2>Replay Buffer<a class="headerlink" href="#replay-buffer" title="Link to this heading">#</a></h2>
<section id="module-minestudio.online.rollout.replay_buffer.actor">
<span id="actor"></span><h3>Actor<a class="headerlink" href="#module-minestudio.online.rollout.replay_buffer.actor" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.actor.ChunkRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.replay_buffer.actor.</span></span><span class="sig-name descname"><span class="pre">ChunkRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_records</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.rollout.replay_buffer.actor.FragmentRecord" title="minestudio.online.rollout.replay_buffer.actor.FragmentRecord"><span class="pre">FragmentRecord</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">session_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/actor.html#ChunkRecord"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.actor.ChunkRecord" title="Link to this definition">#</a></dt>
<dd><p>Represents a chunk of fragment records, along with model version, session ID, and use count.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fragment_records</strong> – A list of FragmentRecord objects that form this chunk.</p></li>
<li><p><strong>model_version</strong> – The model version associated with the fragments in this chunk.</p></li>
<li><p><strong>session_id</strong> – The session ID associated with the fragments in this chunk.</p></li>
<li><p><strong>use_count</strong> – How many times this chunk has been used for training.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.actor.FragmentManager">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.replay_buffer.actor.</span></span><span class="sig-name descname"><span class="pre">FragmentManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_store</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore" title="minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore"><span class="pre">FragmentStore</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/actor.html#FragmentManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.actor.FragmentManager" title="Link to this definition">#</a></dt>
<dd><p>Manages fragments stored in a FragmentStore, primarily by tracking their reference counts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment_store</strong> – An instance of FragmentStore where fragments are physically stored.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.actor.FragmentManager.clean">
<span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/actor.html#FragmentManager.clean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.actor.FragmentManager.clean" title="Link to this definition">#</a></dt>
<dd><p>Removes a fragment from the reference count and deletes it from the FragmentStore.</p>
<p>This method is called when a fragment’s reference count drops to zero.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment_id</strong> – The unique identifier of the fragment to clean.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.actor.FragmentManager.create_fragment_record">
<span class="sig-name descname"><span class="pre">create_fragment_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentMetadata" title="minestudio.online.utils.rollout.datatypes.FragmentMetadata"><span class="pre">FragmentMetadata</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/actor.html#FragmentManager.create_fragment_record"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.actor.FragmentManager.create_fragment_record" title="Link to this definition">#</a></dt>
<dd><p>Creates a new FragmentRecord for a given fragment_id and its metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fragment_id</strong> – The unique identifier of the fragment.</p></li>
<li><p><strong>metadata</strong> – The FragmentMetadata associated with this fragment.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new FragmentRecord instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.actor.FragmentRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.replay_buffer.actor.</span></span><span class="sig-name descname"><span class="pre">FragmentRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentMetadata" title="minestudio.online.utils.rollout.datatypes.FragmentMetadata"><span class="pre">FragmentMetadata</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">manager</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/actor.html#FragmentRecord"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.actor.FragmentRecord" title="Link to this definition">#</a></dt>
<dd><p>Represents a record of a fragment with its metadata and a reference to the FragmentManager.</p>
<p>This class is used to track references to fragments in the FragmentStore.
When a FragmentRecord instance is deleted (no longer referenced),
it informs the FragmentManager to potentially clean up the fragment from the store
if its reference count drops to zero.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fragment_id</strong> – The unique identifier of the fragment.</p></li>
<li><p><strong>metadata</strong> – The FragmentMetadata associated with this fragment.</p></li>
<li><p><strong>manager</strong> – The FragmentManager instance that manages this fragment.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-minestudio.online.rollout.replay_buffer.fragment_store">
<span id="fragment-store"></span><h3>Fragment Store<a class="headerlink" href="#module-minestudio.online.rollout.replay_buffer.fragment_store" title="Link to this heading">#</a></h3>
<p>Date: 2025-05-20 12:09:48
LastEditors: caishaofei-mus1 <a class="reference external" href="mailto:1744260356&#37;&#52;&#48;qq&#46;com">1744260356<span>&#64;</span>qq<span>&#46;</span>com</a>
LastEditTime: 2025-05-23 11:39:33
FilePath: /MineStudio/var/minestudio/online/rollout/replay_buffer/fragment_store.py</p>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.replay_buffer.fragment_store.</span></span><span class="sig-name descname"><span class="pre">FragmentStore</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#FragmentStore"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore" title="Link to this definition">#</a></dt>
<dd><p>A class that provides an interface to either a local or a remote fragment store.</p>
<p>It checks if the current Ray node has a “database” resource. If so, it uses
a LocalFragmentStoreImpl. Otherwise, it uses a RemoteFragmentStoreImpl actor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kwargs</strong> – Keyword arguments to be passed to the underlying store implementation (LocalFragmentStoreImpl or RemoteFragmentStoreImpl).</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – if the local status cannot be determined.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.add_fragment">
<span class="sig-name descname"><span class="pre">add_fragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.SampleFragment" title="minestudio.online.utils.rollout.datatypes.SampleFragment"><span class="pre">SampleFragment</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#FragmentStore.add_fragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.add_fragment" title="Link to this definition">#</a></dt>
<dd><p>Adds a fragment to the store (either local or remote).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment</strong> – The SampleFragment object to store.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A unique string ID for the stored fragment.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#FragmentStore.clear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.clear" title="Link to this definition">#</a></dt>
<dd><p>Removes all fragments from the store (either local or remote).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.delete_fragment">
<span class="sig-name descname"><span class="pre">delete_fragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#FragmentStore.delete_fragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.delete_fragment" title="Link to this definition">#</a></dt>
<dd><p>Deletes a fragment from the store (either local or remote) by its unique ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment_uuid</strong> – The unique ID of the fragment to delete.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.get_disk_space">
<span class="sig-name descname"><span class="pre">get_disk_space</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#FragmentStore.get_disk_space"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.get_disk_space" title="Link to this definition">#</a></dt>
<dd><p>Gets the total disk space used by the cache (either local or remote) in bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The disk space used by the cache.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.get_fragment">
<span class="sig-name descname"><span class="pre">get_fragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.SampleFragment" title="minestudio.online.utils.rollout.datatypes.SampleFragment"><span class="pre">SampleFragment</span></a></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#FragmentStore.get_fragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.get_fragment" title="Link to this definition">#</a></dt>
<dd><p>Retrieves a fragment from the store (either local or remote) by its unique ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment_uuid</strong> – The unique ID of the fragment to retrieve.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The retrieved SampleFragment object.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.replay_buffer.fragment_store.</span></span><span class="sig-name descname"><span class="pre">LocalFragmentStoreImpl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_shards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#LocalFragmentStoreImpl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl" title="Link to this definition">#</a></dt>
<dd><p>A local implementation of a fragment store using diskcache.FanoutCache.</p>
<p>This class provides methods to add, get, delete, and clear fragments
stored on the local disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> – The directory path where the cache will be stored.</p></li>
<li><p><strong>num_shards</strong> – The number of shards to use for the FanoutCache.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.add_fragment">
<span class="sig-name descname"><span class="pre">add_fragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.SampleFragment" title="minestudio.online.utils.rollout.datatypes.SampleFragment"><span class="pre">SampleFragment</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#LocalFragmentStoreImpl.add_fragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.add_fragment" title="Link to this definition">#</a></dt>
<dd><p>Adds a fragment to the store and returns a unique ID for it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment</strong> – The SampleFragment object to store.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A unique string ID for the stored fragment.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#LocalFragmentStoreImpl.clear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.clear" title="Link to this definition">#</a></dt>
<dd><p>Removes all fragments from the store.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.delete_fragment">
<span class="sig-name descname"><span class="pre">delete_fragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#LocalFragmentStoreImpl.delete_fragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.delete_fragment" title="Link to this definition">#</a></dt>
<dd><p>Deletes a fragment from the store by its unique ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment_uuid</strong> – The unique ID of the fragment to delete.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.get_disk_space">
<span class="sig-name descname"><span class="pre">get_disk_space</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#LocalFragmentStoreImpl.get_disk_space"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.get_disk_space" title="Link to this definition">#</a></dt>
<dd><p>Gets the total disk space used by the cache in bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The disk space used by the cache.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.get_fragment">
<span class="sig-name descname"><span class="pre">get_fragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/fragment_store.html#LocalFragmentStoreImpl.get_fragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.get_fragment" title="Link to this definition">#</a></dt>
<dd><p>Retrieves a fragment from the store by its unique ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment_uuid</strong> – The unique ID of the fragment to retrieve.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The retrieved SampleFragment object.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-minestudio.online.rollout.replay_buffer.interface">
<span id="replay-buffer-interface"></span><h3>Replay Buffer Interface<a class="headerlink" href="#module-minestudio.online.rollout.replay_buffer.interface" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.rollout.replay_buffer.interface.</span></span><span class="sig-name descname"><span class="pre">ReplayBufferInterface</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">omegaconf.DictConfig</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/interface.html#ReplayBufferInterface"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface" title="Link to this definition">#</a></dt>
<dd><p>Provides an interface to interact with the ReplayBufferActor.</p>
<p>This class handles the creation or connection to a ReplayBufferActor named “replay_buffer”.
It also initializes a FragmentStore based on the actor’s database configuration.
All methods to interact with the replay buffer (add, load, fetch fragments, update model version)
are routed through the ReplayBufferActor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> – Optional DictConfig. If provided, a new ReplayBufferActor is created with this config.
If None, it attempts to connect to an existing actor named “replay_buffer”.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If config is provided but an actor already exists, or if config is None and no actor exists.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.add_fragment">
<span class="sig-name descname"><span class="pre">add_fragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.SampleFragment" title="minestudio.online.utils.rollout.datatypes.SampleFragment"><span class="pre">SampleFragment</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentMetadata" title="minestudio.online.utils.rollout.datatypes.FragmentMetadata"><span class="pre">FragmentMetadata</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/interface.html#ReplayBufferInterface.add_fragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.add_fragment" title="Link to this definition">#</a></dt>
<dd><p>Adds a fragment to the FragmentStore and then informs the ReplayBufferActor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fragment</strong> – The SampleFragment to add.</p></li>
<li><p><strong>metadata</strong> – The FragmentMetadata associated with the fragment.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.fetch_fragments">
<span class="sig-name descname"><span class="pre">fetch_fragments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_fragments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex" title="minestudio.online.utils.rollout.datatypes.FragmentIndex"><span class="pre">FragmentIndex</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/interface.html#ReplayBufferInterface.fetch_fragments"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.fetch_fragments" title="Link to this definition">#</a></dt>
<dd><p>Fetches a list of fragment IDs and their indices from the ReplayBufferActor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>num_fragments</strong> – The number of fragments to fetch.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of tuples, each containing a FragmentIndex and the fragment_id.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.load_fragment">
<span class="sig-name descname"><span class="pre">load_fragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.SampleFragment" title="minestudio.online.utils.rollout.datatypes.SampleFragment"><span class="pre">SampleFragment</span></a></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/interface.html#ReplayBufferInterface.load_fragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.load_fragment" title="Link to this definition">#</a></dt>
<dd><p>Loads a fragment directly from the FragmentStore.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment_id</strong> – The unique ID of the fragment to load.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The loaded SampleFragment.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.prepared_fragments">
<span class="sig-name descname"><span class="pre">prepared_fragments</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex" title="minestudio.online.utils.rollout.datatypes.FragmentIndex"><span class="pre">FragmentIndex</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/interface.html#ReplayBufferInterface.prepared_fragments"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.prepared_fragments" title="Link to this definition">#</a></dt>
<dd><p>Retrieves the fragments that were prepared by the last call to fetch_fragments in the ReplayBufferActor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of tuples, each containing a FragmentIndex and the fragment_id.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.update_model_version">
<span class="sig-name descname"><span class="pre">update_model_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/interface.html#ReplayBufferInterface.update_model_version"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.update_model_version" title="Link to this definition">#</a></dt>
<dd><p>Updates the model version in the ReplayBufferActor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_id</strong> – The ID of the current training session.</p></li>
<li><p><strong>model_version</strong> – The new model version.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The result of the actor’s method call.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.update_training_session">
<span class="sig-name descname"><span class="pre">update_training_session</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/rollout/replay_buffer/interface.html#ReplayBufferInterface.update_training_session"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.update_training_session" title="Link to this definition">#</a></dt>
<dd><p>Calls the update_training_session method of the ReplayBufferActor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The result of the actor’s method call.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="trainer">
<h2>Trainer<a class="headerlink" href="#trainer" title="Link to this heading">#</a></h2>
<section id="module-minestudio.online.trainer.basetrainer">
<span id="base-trainer"></span><h3>Base Trainer<a class="headerlink" href="#module-minestudio.online.trainer.basetrainer" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.trainer.basetrainer.BaseTrainer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.trainer.basetrainer.</span></span><span class="sig-name descname"><span class="pre">BaseTrainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rollout_manager</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ActorHandle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy_generator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../models/index.html#minestudio.models.base_policy.MinePolicy" title="minestudio.models.base_policy.MinePolicy"><span class="pre">MinePolicy</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_generator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../simulator/index.html#minestudio.simulator.entry.MinecraftSim" title="minestudio.simulator.entry.MinecraftSim"><span class="pre">MinecraftSim</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_workers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_readers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_cpus_per_reader</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_gpus_per_worker</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefetch_batches</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">discount</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gae_lambda</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_normalized_vf</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inference_batch_size_per_gpu</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resume</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resume_optimizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/basetrainer.html#BaseTrainer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.basetrainer.BaseTrainer" title="Link to this definition">#</a></dt>
<dd><p>Base class for PPO-style trainers.</p>
<p>This class provides the core logic for distributed training, including:
- Managing rollout workers and a replay buffer.
- Fetching experience fragments and calculating GAE (Generalized Advantage Estimation).
- Broadcasting model updates to rollout workers.
- Setting up the training loop using Ray Train.</p>
<p>Subclasses should implement <cite>setup_model_and_optimizer</cite> and <cite>train</cite> methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rollout_manager</strong> – ActorHandle for the RolloutManager.</p></li>
<li><p><strong>policy_generator</strong> – Callable that returns a MinePolicy instance.</p></li>
<li><p><strong>env_generator</strong> – Callable that returns a MinecraftSim instance.</p></li>
<li><p><strong>num_workers</strong> – Number of training workers (Ray actors).</p></li>
<li><p><strong>num_readers</strong> – Number of parallel data readers for fetching fragments.</p></li>
<li><p><strong>num_cpus_per_reader</strong> – Number of CPUs allocated to each data reader.</p></li>
<li><p><strong>num_gpus_per_worker</strong> – Number of GPUs allocated to each training worker.</p></li>
<li><p><strong>prefetch_batches</strong> – Number of batches to prefetch during data loading.</p></li>
<li><p><strong>discount</strong> – Discount factor (gamma) for GAE.</p></li>
<li><p><strong>gae_lambda</strong> – Lambda parameter for GAE.</p></li>
<li><p><strong>context_length</strong> – The length of the context window for processing sequences.</p></li>
<li><p><strong>use_normalized_vf</strong> – Whether to use a normalized value function.</p></li>
<li><p><strong>inference_batch_size_per_gpu</strong> – Batch size for inference on each GPU during GAE calculation.</p></li>
<li><p><strong>resume</strong> – Optional path to a checkpoint directory to resume training from.</p></li>
<li><p><strong>resume_optimizer</strong> – Whether to resume the optimizer state if resuming from a checkpoint.</p></li>
<li><p><strong>kwargs</strong> – Additional keyword arguments.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.basetrainer.BaseTrainer.broadcast_model_to_rollout_workers">
<span class="sig-name descname"><span class="pre">broadcast_model_to_rollout_workers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_version</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/basetrainer.html#BaseTrainer.broadcast_model_to_rollout_workers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.basetrainer.BaseTrainer.broadcast_model_to_rollout_workers" title="Link to this definition">#</a></dt>
<dd><p>Broadcasts the current model state_dict to all rollout workers.</p>
<p>This is typically called after a model update. If <cite>new_version</cite> is True,
the internal model version is incremented before broadcasting.
Only rank 0 worker performs the broadcast.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>new_version</strong> – If True, increments the model version.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.basetrainer.BaseTrainer.fetch_fragments_and_estimate_advantages">
<span class="sig-name descname"><span class="pre">fetch_fragments_and_estimate_advantages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_fragments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/trainer/basetrainer.html#BaseTrainer.fetch_fragments_and_estimate_advantages"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.basetrainer.BaseTrainer.fetch_fragments_and_estimate_advantages" title="Link to this definition">#</a></dt>
<dd><p>Fetches a batch of fragments from the replay buffer and calculates advantages using GAE.</p>
<p>This method orchestrates the following steps:
1. Rank 0 worker fetches <cite>num_fragments</cite> from the ReplayBufferInterface.
2. The fetched fragment records are distributed among the training workers.
3. Each worker performs inference on its assigned fragments to get vpreds and logps.
4. Information required for GAE (rewards, vpreds, next_done, next_vpred) is sent to a GAEWorker actor.
5. Rank 0 worker triggers GAE calculation in the GAEWorker.
6. Each worker retrieves its calculated td_targets and advantages from the GAEWorker.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>num_fragments</strong> – The total number of fragments to fetch and process.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing:
- “records”: The list of FragmentIndex and fragment_id tuples processed by this worker.
- “rewards”: A FragmentDataDict of summed rewards for each fragment.
- “td_targets”: A FragmentDataDict of TD targets (GAE targets) for each step.
- “advantages”: A FragmentDataDict of advantages for each step.
- “old_logps”: A FragmentDataDict of log probabilities of actions under the policy used for rollout.
- “old_pi_logits”: A FragmentDataDict of policy logits from the rollout.
- “old_vpreds”: A FragmentDataDict of value predictions from the rollout.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.basetrainer.BaseTrainer.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/basetrainer.html#BaseTrainer.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.basetrainer.BaseTrainer.fit" title="Link to this definition">#</a></dt>
<dd><p>Initializes and runs the Ray TorchTrainer to start the distributed training process.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.basetrainer.BaseTrainer.setup_model_and_optimizer">
<span class="sig-name descname"><span class="pre">setup_model_and_optimizer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../models/index.html#minestudio.models.base_policy.MinePolicy" title="minestudio.models.base_policy.MinePolicy"><span class="pre">MinePolicy</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optimizer</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/trainer/basetrainer.html#BaseTrainer.setup_model_and_optimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.basetrainer.BaseTrainer.setup_model_and_optimizer" title="Link to this definition">#</a></dt>
<dd><p>Abstract method to be implemented by subclasses.</p>
<p>This method should initialize and return the policy model and its optimizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tuple containing the initialized MinePolicy model and a torch.optim.Optimizer.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NotImplementedError</strong> – If not implemented by a subclass.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.basetrainer.BaseTrainer.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/basetrainer.html#BaseTrainer.train"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.basetrainer.BaseTrainer.train" title="Link to this definition">#</a></dt>
<dd><p>Abstract method for the main training loop, to be implemented by subclasses.</p>
<p>This method will contain the logic for iterating through training steps/epochs,
fetching data, performing model updates, logging, and saving checkpoints.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>NotImplementedError</strong> – If not implemented by a subclass.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-minestudio.online.trainer.ppotrainer">
<span id="ppo-trainer"></span><h3>PPO Trainer<a class="headerlink" href="#module-minestudio.online.trainer.ppotrainer" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.trainer.ppotrainer.PPOTrainer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.trainer.ppotrainer.</span></span><span class="sig-name descname"><span class="pre">PPOTrainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_iterations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">anneal_lr_linearly</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_decay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adam_eps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size_per_gpu</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batches_per_iteration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_accumulation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs_per_iteration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vf_warmup</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppo_clip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip_vloss</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_grad_norm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_initial_vf</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppo_vf_coef</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppo_policy_coef</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kl_divergence_coef_rho</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entropy_bonus_coef</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coef_rho_decay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize_advantage_full_batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">record_video_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_ratio_range</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_ref_update</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="k"><span class="pre">False</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">whole_config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/ppotrainer.html#PPOTrainer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.ppotrainer.PPOTrainer" title="Link to this definition">#</a></dt>
<dd><p>Proximal Policy Optimization (PPO) trainer for reinforcement learning.</p>
<p>This class implements the PPO algorithm for training policies in Minecraft environments.
It extends BaseTrainer and provides functionality for distributed training with Ray,
gradient accumulation, value function warmup, and various PPO-specific optimizations
including clipping, entropy bonuses, and KL divergence regularization.</p>
<p>The trainer supports both policy and value function training with configurable
coefficients, learning rate annealing, and checkpoint saving capabilities.</p>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.ppotrainer.PPOTrainer.ppo_update">
<span class="sig-name descname"><span class="pre">ppo_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">records</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex" title="minestudio.online.utils.rollout.datatypes.FragmentIndex"><span class="pre">FragmentIndex</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">td_targets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict" title="minestudio.online.utils.rollout.datatypes.FragmentDataDict"><span class="pre">FragmentDataDict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">advantages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict" title="minestudio.online.utils.rollout.datatypes.FragmentDataDict"><span class="pre">FragmentDataDict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_logps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict" title="minestudio.online.utils.rollout.datatypes.FragmentDataDict"><span class="pre">FragmentDataDict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_vpreds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict" title="minestudio.online.utils.rollout.datatypes.FragmentDataDict"><span class="pre">FragmentDataDict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rewards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict" title="minestudio.online.utils.rollout.datatypes.FragmentDataDict"><span class="pre">FragmentDataDict</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/ppotrainer.html#PPOTrainer.ppo_update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.ppotrainer.PPOTrainer.ppo_update" title="Link to this definition">#</a></dt>
<dd><p>Perform PPO policy and value function updates on collected trajectory data.</p>
<p>Implements the core PPO algorithm including:
- Policy loss computation with probability ratio clipping
- Value function loss with optional clipping
- KL divergence regularization against reference policy
- Entropy bonus for exploration
- Advantage normalization and gradient accumulation
- Distributed training synchronization and error handling</p>
<p>The method processes data in batches across multiple epochs, computing various
metrics and losses while handling numerical stability issues. Includes
checkpoint saving and performance logging.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>records</strong> – List of (fragment_index, worker_id) tuples identifying data fragments</p></li>
<li><p><strong>td_targets</strong> – Temporal difference targets for value function training</p></li>
<li><p><strong>advantages</strong> – Computed advantages for policy gradient estimation</p></li>
<li><p><strong>old_logps</strong> – Log probabilities from the policy that collected the data</p></li>
<li><p><strong>old_vpreds</strong> – Value predictions from the policy that collected the data</p></li>
<li><p><strong>rewards</strong> – Reward values from the trajectory fragments</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>AssertionError</strong> – If reference model is None when KL regularization is enabled</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.ppotrainer.PPOTrainer.setup_model_and_optimizer">
<span class="sig-name descname"><span class="pre">setup_model_and_optimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy_generator</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../models/index.html#minestudio.models.base_policy.MinePolicy" title="minestudio.models.base_policy.MinePolicy"><span class="pre">MinePolicy</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optimizer</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/trainer/ppotrainer.html#PPOTrainer.setup_model_and_optimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.ppotrainer.PPOTrainer.setup_model_and_optimizer" title="Link to this definition">#</a></dt>
<dd><p>Set up the model and optimizer for PPO training.</p>
<p>Creates the main policy model using the provided generator function and configures
an AdamW optimizer with the specified hyperparameters. Optionally initializes
value function weights to zero and sets up a reference model for KL divergence
regularization if enabled.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>policy_generator</strong> – Function that returns a new instance of the policy model</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of (model, optimizer) ready for training</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>AssertionError</strong> – If reference model setup fails when KL regularization is enabled</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.ppotrainer.PPOTrainer.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/ppotrainer.html#PPOTrainer.train"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.ppotrainer.PPOTrainer.train" title="Link to this definition">#</a></dt>
<dd><p>Execute the main PPO training loop.</p>
<p>Runs the complete training process for the specified number of iterations.
Each iteration involves collecting rollout data, computing advantages, and
performing PPO updates. Handles learning rate annealing, model broadcasting
to rollout workers, and checkpoint management.</p>
<p>The method supports resuming from checkpoints by detecting current learning
rate and calculating the appropriate starting iteration. Includes distributed
training coordination and logging.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.trainer.ppotrainer.PPOTrainer.train_iteration">
<span class="sig-name descname"><span class="pre">train_iteration</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/ppotrainer.html#PPOTrainer.train_iteration"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.ppotrainer.PPOTrainer.train_iteration" title="Link to this definition">#</a></dt>
<dd><p>Execute a single training iteration of the PPO algorithm.</p>
<p>Performs one complete iteration consisting of:
1. Fetching trajectory fragments from rollout workers
2. Computing Generalized Advantage Estimation (GAE)
3. Performing PPO updates on the collected data
4. Decaying the KL divergence coefficient</p>
<p>This method coordinates between data collection and policy optimization phases
of the PPO algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.trainer.ppotrainer.print_memory_usage">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.trainer.ppotrainer.</span></span><span class="sig-name descname"><span class="pre">print_memory_usage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/ppotrainer.html#print_memory_usage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.ppotrainer.print_memory_usage" title="Link to this definition">#</a></dt>
<dd><p>Print current CUDA memory usage information.</p>
<p>This function displays the allocated and reserved memory on the current CUDA device
in megabytes (MB). Useful for debugging memory issues during training.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None (prints memory information to stdout)</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-minestudio.online.trainer.start_trainer">
<span id="start-trainer"></span><h3>Start Trainer<a class="headerlink" href="#module-minestudio.online.trainer.start_trainer" title="Link to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.trainer.start_trainer.start_trainer">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.trainer.start_trainer.</span></span><span class="sig-name descname"><span class="pre">start_trainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy_generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">online_cfg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">whole_config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/trainer/start_trainer.html#start_trainer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.trainer.start_trainer.start_trainer" title="Link to this definition">#</a></dt>
<dd><p>Starts the training process.</p>
<p>This function initializes and starts a training session, creating a trainer
instance based on the provided configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>policy_generator</strong> – A function to generate the policy model.</p></li>
<li><p><strong>env_generator</strong> – A function to generate the environment.</p></li>
<li><p><strong>online_cfg</strong> – Online training configuration.</p></li>
<li><p><strong>whole_config</strong> – The entire configuration as a string.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="utils">
<h2>Utils<a class="headerlink" href="#utils" title="Link to this heading">#</a></h2>
<section id="module-minestudio.online.utils.rollout.datatypes">
<span id="rollout-utils"></span><h3>Rollout Utils<a class="headerlink" href="#module-minestudio.online.utils.rollout.datatypes" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.datatypes.FragmentDataDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.rollout.datatypes.</span></span><span class="sig-name descname"><span class="pre">FragmentDataDict</span></span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/datatypes.html#FragmentDataDict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict" title="Link to this definition">#</a></dt>
<dd><p>A dictionary that maps FragmentIndex to arbitrary data.
It provides a helper method to format a batch of fragments for model input.</p>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.datatypes.FragmentDataDict.format_batch">
<span class="sig-name descname"><span class="pre">format_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.SampleFragment" title="minestudio.online.utils.rollout.datatypes.SampleFragment"><span class="pre">SampleFragment</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/datatypes.html#FragmentDataDict.format_batch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict.format_batch" title="Link to this definition">#</a></dt>
<dd><p>Formats a list of SampleFragments into a batch suitable for model input.
It retrieves the corresponding data for each fragment from the dictionary,
stacks them, and moves them to the specified device.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fragments</strong> – A list of SampleFragment objects.</p></li>
<li><p><strong>device</strong> – The torch device to move the batch to.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A batch of data ready for model input.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.datatypes.FragmentIndex">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.rollout.datatypes.</span></span><span class="sig-name descname"><span class="pre">FragmentIndex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">worker_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fid_in_worker</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/datatypes.html#FragmentIndex"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex" title="Link to this definition">#</a></dt>
<dd><p>Represents a unique identifier for a SampleFragment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>worker_uuid</strong> – The unique identifier of the worker that generated the fragment.</p></li>
<li><p><strong>fid_in_worker</strong> – The fragment’s ID within that worker.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.datatypes.FragmentMetadata">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.rollout.datatypes.</span></span><span class="sig-name descname"><span class="pre">FragmentMetadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">session_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">worker_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fid_in_worker</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/datatypes.html#FragmentMetadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.datatypes.FragmentMetadata" title="Link to this definition">#</a></dt>
<dd><p>Metadata associated with a SampleFragment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_version</strong> – The version of the model used to generate this fragment.</p></li>
<li><p><strong>session_id</strong> – The ID of the training session.</p></li>
<li><p><strong>worker_uuid</strong> – The unique identifier of the worker that generated the fragment.</p></li>
<li><p><strong>fid_in_worker</strong> – The fragment’s ID within that worker.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.datatypes.SampleFragment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.rollout.datatypes.</span></span><span class="sig-name descname"><span class="pre">SampleFragment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_done</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">in_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">worker_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fid_in_worker</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">episode_uuids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/datatypes.html#SampleFragment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.datatypes.SampleFragment" title="Link to this definition">#</a></dt>
<dd><p>Represents a fragment of a trajectory, containing observations, actions, rewards, and other metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> – The observation from the environment.</p></li>
<li><p><strong>action</strong> – The action taken by the agent.</p></li>
<li><p><strong>next_done</strong> – A boolean indicating whether the episode terminated after this fragment.</p></li>
<li><p><strong>reward</strong> – The reward received after taking the action.</p></li>
<li><p><strong>first</strong> – A boolean indicating if this is the first fragment in an episode.</p></li>
<li><p><strong>in_state</strong> – The recurrent state of the agent.</p></li>
<li><p><strong>worker_uuid</strong> – The unique identifier of the worker that generated the fragment.</p></li>
<li><p><strong>fid_in_worker</strong> – The fragment’s ID within that worker.</p></li>
<li><p><strong>next_obs</strong> – The next observation from the environment.</p></li>
<li><p><strong>episode_uuids</strong> – A list of unique identifiers for the episodes this fragment belongs to.</p></li>
</ul>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.datatypes.SampleFragment.index">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">index</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex" title="minestudio.online.utils.rollout.datatypes.FragmentIndex"><span class="pre">FragmentIndex</span></a></em><a class="headerlink" href="#minestudio.online.utils.rollout.datatypes.SampleFragment.index" title="Link to this definition">#</a></dt>
<dd><p>Returns the FragmentIndex for this SampleFragment.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The FragmentIndex object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.datatypes.SampleFragment.print">
<span class="sig-name descname"><span class="pre">print</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/datatypes.html#SampleFragment.print"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.datatypes.SampleFragment.print" title="Link to this definition">#</a></dt>
<dd><p>Prints the contents of the SampleFragment for debugging purposes.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.datatypes.StepRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.rollout.datatypes.</span></span><span class="sig-name descname"><span class="pre">StepRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">worker_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_reward</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_terminated</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_truncated</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">episode_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">session_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/datatypes.html#StepRecord"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.datatypes.StepRecord" title="Link to this definition">#</a></dt>
<dd><p>Represents a single step taken in the environment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>worker_uuid</strong> – The unique identifier of the worker that generated this step.</p></li>
<li><p><strong>obs</strong> – The observation from the environment.</p></li>
<li><p><strong>state</strong> – The recurrent state of the agent.</p></li>
<li><p><strong>action</strong> – The action taken by the agent.</p></li>
<li><p><strong>last_reward</strong> – The reward received from the previous step.</p></li>
<li><p><strong>last_terminated</strong> – Whether the episode terminated after the previous step.</p></li>
<li><p><strong>last_truncated</strong> – Whether the episode was truncated after the previous step.</p></li>
<li><p><strong>model_version</strong> – The version of the model used to generate this step.</p></li>
<li><p><strong>episode_uuid</strong> – The unique identifier of the episode this step belongs to.</p></li>
<li><p><strong>session_id</strong> – The ID of the training session.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class" id="module-minestudio.online.utils.rollout.monitor">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.monitor.MovingStat">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.rollout.monitor.</span></span><span class="sig-name descname"><span class="pre">MovingStat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">duration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/monitor.html#MovingStat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.monitor.MovingStat" title="Link to this definition">#</a></dt>
<dd><p>Calculates a moving statistic (average) over a specified duration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>duration</strong> – The duration in seconds over which to calculate the statistic.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.monitor.MovingStat.average">
<span class="sig-name descname"><span class="pre">average</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/monitor.html#MovingStat.average"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.monitor.MovingStat.average" title="Link to this definition">#</a></dt>
<dd><p>Calculates the average of the data points currently within the duration window.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The average of the data points, or float(‘nan’) if no data is available.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.monitor.MovingStat.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/monitor.html#MovingStat.update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.monitor.MovingStat.update" title="Link to this definition">#</a></dt>
<dd><p>Adds a new data point to the calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x</strong> – The new data point.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.monitor.PipelineMonitor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.rollout.monitor.</span></span><span class="sig-name descname"><span class="pre">PipelineMonitor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">300</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/monitor.html#PipelineMonitor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.monitor.PipelineMonitor" title="Link to this definition">#</a></dt>
<dd><p>Monitors the time spent in different stages of a pipeline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stages</strong> – A list of strings representing the names of the pipeline stages.</p></li>
<li><p><strong>duration</strong> – The duration in seconds over which to calculate moving statistics for each stage.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.monitor.PipelineMonitor.print">
<span class="sig-name descname"><span class="pre">print</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/monitor.html#PipelineMonitor.print"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.monitor.PipelineMonitor.print" title="Link to this definition">#</a></dt>
<dd><p>Prints a table summarizing the average time spent in each stage for all monitored pipelines.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.online.utils.rollout.monitor.PipelineMonitor.report_enter">
<span class="sig-name descname"><span class="pre">report_enter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pipeline_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/rollout/monitor.html#PipelineMonitor.report_enter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.rollout.monitor.PipelineMonitor.report_enter" title="Link to this definition">#</a></dt>
<dd><p>Reports that a pipeline has entered a new stage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage</strong> – The name of the stage being entered.</p></li>
<li><p><strong>pipeline_id</strong> – The unique identifier of the pipeline instance.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – If the reported stage is not the expected next stage.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-minestudio.online.utils.train.data">
<span id="trainer-utils"></span><h3>Trainer Utils<a class="headerlink" href="#module-minestudio.online.utils.train.data" title="Link to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.utils.train.data.batchify_next_obs">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.train.data.</span></span><span class="sig-name descname"><span class="pre">batchify_next_obs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">next_obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/train/data.html#batchify_next_obs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.train.data.batchify_next_obs" title="Link to this definition">#</a></dt>
<dd><p>Converts a next_obs dictionary into a batch format suitable for model input.</p>
<p>It stacks the next_obs (assumed to be a single observation) and moves it to the specified device.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>next_obs</strong> – A dictionary representing the next observation.</p></li>
<li><p><strong>device</strong> – The torch device to move the batch to.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The batchified next_obs as a torch Tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.utils.train.data.create_loader_pool">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.train.data.</span></span><span class="sig-name descname"><span class="pre">create_loader_pool</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_readers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_cpus_per_reader</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/train/data.html#create_loader_pool"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.train.data.create_loader_pool" title="Link to this definition">#</a></dt>
<dd><p>Creates a pool of FragmentLoader actors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_readers</strong> – The number of FragmentLoader actors to create in the pool.</p></li>
<li><p><strong>num_cpus_per_reader</strong> – The number of CPUs to allocate to each FragmentLoader actor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An ActorPool of FragmentLoader actors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.utils.train.data.data_iter">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.train.data.</span></span><span class="sig-name descname"><span class="pre">data_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loader_pool</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ActorPool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">records</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex" title="minestudio.online.utils.rollout.datatypes.FragmentIndex"><span class="pre">FragmentIndex</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefetch_batches</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/train/data.html#data_iter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.train.data.data_iter" title="Link to this definition">#</a></dt>
<dd><p>Creates an iterator that yields batches of SampleFragments loaded by the FragmentLoader pool.</p>
<p>It shuffles the records, prefetches data, and yields batches of a specified size.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loader_pool</strong> – The ActorPool of FragmentLoader actors.</p></li>
<li><p><strong>records</strong> – A list of tuples, where each tuple contains a FragmentIndex and a fragment UUID.</p></li>
<li><p><strong>batch_size</strong> – The number of fragments per batch.</p></li>
<li><p><strong>prefetch_batches</strong> – The number of batches to prefetch.</p></li>
</ul>
</dd>
<dt class="field-even">Yields<span class="colon">:</span></dt>
<dd class="field-even"><p>Batches of SampleFragments, where each batch is a list of dictionaries (output of FragmentLoader.load).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.utils.train.data.prepare_batch">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.train.data.</span></span><span class="sig-name descname"><span class="pre">prepare_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_fragments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.SampleFragment" title="minestudio.online.utils.rollout.datatypes.SampleFragment"><span class="pre">SampleFragment</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/train/data.html#prepare_batch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.train.data.prepare_batch" title="Link to this definition">#</a></dt>
<dd><p>Prepares a batch of SampleFragments for model input.</p>
<p>It extracts observations, states, actions, and first flags from the fragments,
stacks them, and moves them to the model’s device.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – The model for which the batch is being prepared (used to get the device and merge_state method).</p></li>
<li><p><strong>batch_fragments</strong> – A list of SampleFragment objects.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the prepared batch (obs, state, action, first) as torch Tensors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function" id="module-minestudio.online.utils.train.gae">
<dt class="sig sig-object py" id="minestudio.online.utils.train.gae.get_last_fragment_indexes">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.train.gae.</span></span><span class="sig-name descname"><span class="pre">get_last_fragment_indexes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fragment_indexs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex" title="minestudio.online.utils.rollout.datatypes.FragmentIndex"><span class="pre">FragmentIndex</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex" title="minestudio.online.utils.rollout.datatypes.FragmentIndex"><span class="pre">FragmentIndex</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/online/utils/train/gae.html#get_last_fragment_indexes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.train.gae.get_last_fragment_indexes" title="Link to this definition">#</a></dt>
<dd><p>Identifies the last fragment index for each worker from a list of fragment indexes.</p>
<p>A fragment is considered the last if it’s the last one from a worker or if the next fragment from the same worker is not contiguous.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fragment_indexs</strong> – A list of FragmentIndex objects.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of FragmentIndex objects, each being the last fragment for a worker in a sequence.</p>
</dd>
</dl>
</dd></dl>

<p id="module-minestudio.online.utils.train.training_session">Date: 2025-05-20 18:18:38
LastEditors: caishaofei-mus1 <a class="reference external" href="mailto:1744260356&#37;&#52;&#48;qq&#46;com">1744260356<span>&#64;</span>qq<span>&#46;</span>com</a>
LastEditTime: 2025-05-20 18:23:37
FilePath: /MineStudio/minestudio/online/utils/train/training_session.py</p>
<dl class="py function" id="module-minestudio.online.utils.train.wandb_logger">
<dt class="sig sig-object py" id="minestudio.online.utils.train.wandb_logger.define_metric">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.train.wandb_logger.</span></span><span class="sig-name descname"><span class="pre">define_metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/train/wandb_logger.html#define_metric"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.train.wandb_logger.define_metric" title="Link to this definition">#</a></dt>
<dd><p>Defines a metric for the current Weights &amp; Biases (wandb) training session.</p>
<p>This function retrieves the current training session and calls its <cite>define_metric</cite> method remotely.
If no session is active or an error occurs, an error message is logged.
It asserts that a training session must be active.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – Positional arguments to pass to <cite>wandb.define_metric()</cite>.</p></li>
<li><p><strong>kwargs</strong> – Keyword arguments to pass to <cite>wandb.define_metric()</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.utils.train.wandb_logger.log">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.train.wandb_logger.</span></span><span class="sig-name descname"><span class="pre">log</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/train/wandb_logger.html#log"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.train.wandb_logger.log" title="Link to this definition">#</a></dt>
<dd><p>Logs data to the current Weights &amp; Biases (wandb) training session.</p>
<p>This function retrieves the current training session and calls its <cite>log</cite> method remotely.
If no session is active or an error occurs during logging, an error message is logged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – Positional arguments to pass to <cite>wandb.log()</cite>.</p></li>
<li><p><strong>kwargs</strong> – Keyword arguments to pass to <cite>wandb.log()</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.online.utils.train.wandb_logger.log_video">
<span class="sig-prename descclassname"><span class="pre">minestudio.online.utils.train.wandb_logger.</span></span><span class="sig-name descname"><span class="pre">log_video</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">video_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/online/utils/train/wandb_logger.html#log_video"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.online.utils.train.wandb_logger.log_video" title="Link to this definition">#</a></dt>
<dd><p>Logs a video to the current Weights &amp; Biases (wandb) training session.</p>
<p>This function retrieves the current training session and calls its <cite>log_video</cite> method remotely.
If no session is active or an error occurs during logging, an error message is logged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – A dictionary containing the data to log. The video itself should be under the <cite>video_key</cite>.</p></li>
<li><p><strong>video_key</strong> – The key in the <cite>data</cite> dictionary that holds the video data.</p></li>
<li><p><strong>fps</strong> – The frames per second of the video.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>

<div class="section ablog__blog_comments">
   
</div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../offline/index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Offline API Documentation</p>
      </div>
    </a>
    <a class="right-next"
       href="../inference/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Inference API Documentation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rollout">Rollout</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.rollout.env_worker">Env Worker</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.EnvWorker"><code class="docutils literal notranslate"><span class="pre">EnvWorker</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.EnvWorker.report_rewards"><code class="docutils literal notranslate"><span class="pre">EnvWorker.report_rewards()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.EnvWorker.reset_state"><code class="docutils literal notranslate"><span class="pre">EnvWorker.reset_state()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.EnvWorker.run"><code class="docutils literal notranslate"><span class="pre">EnvWorker.run()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.EnvWorker.step_agent"><code class="docutils literal notranslate"><span class="pre">EnvWorker.step_agent()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.VideoWriter"><code class="docutils literal notranslate"><span class="pre">VideoWriter</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.VideoWriter.close_video"><code class="docutils literal notranslate"><span class="pre">VideoWriter.close_video()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.VideoWriter.open_video"><code class="docutils literal notranslate"><span class="pre">VideoWriter.open_video()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.VideoWriter.run"><code class="docutils literal notranslate"><span class="pre">VideoWriter.run()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.VideoWriter.write_frame"><code class="docutils literal notranslate"><span class="pre">VideoWriter.write_frame()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.env_worker.draw_vpred"><code class="docutils literal notranslate"><span class="pre">draw_vpred()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.rollout.episode_statistics">Episode Statistics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.rollout.rollout_manager">Rollout Manager</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.rollout.rollout_worker">Rollout Worker</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.ProgressHandler"><code class="docutils literal notranslate"><span class="pre">ProgressHandler</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.RolloutWorker"><code class="docutils literal notranslate"><span class="pre">RolloutWorker</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.inference"><code class="docutils literal notranslate"><span class="pre">RolloutWorker.inference()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.load_weights"><code class="docutils literal notranslate"><span class="pre">RolloutWorker.load_weights()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.loop"><code class="docutils literal notranslate"><span class="pre">RolloutWorker.loop()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.poll_environments"><code class="docutils literal notranslate"><span class="pre">RolloutWorker.poll_environments()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.progress_handler"><code class="docutils literal notranslate"><span class="pre">RolloutWorker.progress_handler()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.rollout"><code class="docutils literal notranslate"><span class="pre">RolloutWorker.rollout()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.rollout_worker.RolloutWorker.update_model_version"><code class="docutils literal notranslate"><span class="pre">RolloutWorker.update_model_version()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.rollout.start_manager">Start Manager</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.start_manager.start_rolloutmanager"><code class="docutils literal notranslate"><span class="pre">start_rolloutmanager()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replay-buffer">Replay Buffer</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.rollout.replay_buffer.actor">Actor</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.actor.ChunkRecord"><code class="docutils literal notranslate"><span class="pre">ChunkRecord</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.actor.FragmentManager"><code class="docutils literal notranslate"><span class="pre">FragmentManager</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.actor.FragmentManager.clean"><code class="docutils literal notranslate"><span class="pre">FragmentManager.clean()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.actor.FragmentManager.create_fragment_record"><code class="docutils literal notranslate"><span class="pre">FragmentManager.create_fragment_record()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.actor.FragmentRecord"><code class="docutils literal notranslate"><span class="pre">FragmentRecord</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.rollout.replay_buffer.fragment_store">Fragment Store</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore"><code class="docutils literal notranslate"><span class="pre">FragmentStore</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.add_fragment"><code class="docutils literal notranslate"><span class="pre">FragmentStore.add_fragment()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.clear"><code class="docutils literal notranslate"><span class="pre">FragmentStore.clear()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.delete_fragment"><code class="docutils literal notranslate"><span class="pre">FragmentStore.delete_fragment()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.get_disk_space"><code class="docutils literal notranslate"><span class="pre">FragmentStore.get_disk_space()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.FragmentStore.get_fragment"><code class="docutils literal notranslate"><span class="pre">FragmentStore.get_fragment()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl"><code class="docutils literal notranslate"><span class="pre">LocalFragmentStoreImpl</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.add_fragment"><code class="docutils literal notranslate"><span class="pre">LocalFragmentStoreImpl.add_fragment()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.clear"><code class="docutils literal notranslate"><span class="pre">LocalFragmentStoreImpl.clear()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.delete_fragment"><code class="docutils literal notranslate"><span class="pre">LocalFragmentStoreImpl.delete_fragment()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.get_disk_space"><code class="docutils literal notranslate"><span class="pre">LocalFragmentStoreImpl.get_disk_space()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.fragment_store.LocalFragmentStoreImpl.get_fragment"><code class="docutils literal notranslate"><span class="pre">LocalFragmentStoreImpl.get_fragment()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.rollout.replay_buffer.interface">Replay Buffer Interface</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface"><code class="docutils literal notranslate"><span class="pre">ReplayBufferInterface</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.add_fragment"><code class="docutils literal notranslate"><span class="pre">ReplayBufferInterface.add_fragment()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.fetch_fragments"><code class="docutils literal notranslate"><span class="pre">ReplayBufferInterface.fetch_fragments()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.load_fragment"><code class="docutils literal notranslate"><span class="pre">ReplayBufferInterface.load_fragment()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.prepared_fragments"><code class="docutils literal notranslate"><span class="pre">ReplayBufferInterface.prepared_fragments()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.update_model_version"><code class="docutils literal notranslate"><span class="pre">ReplayBufferInterface.update_model_version()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.rollout.replay_buffer.interface.ReplayBufferInterface.update_training_session"><code class="docutils literal notranslate"><span class="pre">ReplayBufferInterface.update_training_session()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trainer">Trainer</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.trainer.basetrainer">Base Trainer</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.basetrainer.BaseTrainer"><code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.basetrainer.BaseTrainer.broadcast_model_to_rollout_workers"><code class="docutils literal notranslate"><span class="pre">BaseTrainer.broadcast_model_to_rollout_workers()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.basetrainer.BaseTrainer.fetch_fragments_and_estimate_advantages"><code class="docutils literal notranslate"><span class="pre">BaseTrainer.fetch_fragments_and_estimate_advantages()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.basetrainer.BaseTrainer.fit"><code class="docutils literal notranslate"><span class="pre">BaseTrainer.fit()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.basetrainer.BaseTrainer.setup_model_and_optimizer"><code class="docutils literal notranslate"><span class="pre">BaseTrainer.setup_model_and_optimizer()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.basetrainer.BaseTrainer.train"><code class="docutils literal notranslate"><span class="pre">BaseTrainer.train()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.trainer.ppotrainer">PPO Trainer</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.ppotrainer.PPOTrainer"><code class="docutils literal notranslate"><span class="pre">PPOTrainer</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.ppotrainer.PPOTrainer.ppo_update"><code class="docutils literal notranslate"><span class="pre">PPOTrainer.ppo_update()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.ppotrainer.PPOTrainer.setup_model_and_optimizer"><code class="docutils literal notranslate"><span class="pre">PPOTrainer.setup_model_and_optimizer()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.ppotrainer.PPOTrainer.train"><code class="docutils literal notranslate"><span class="pre">PPOTrainer.train()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.ppotrainer.PPOTrainer.train_iteration"><code class="docutils literal notranslate"><span class="pre">PPOTrainer.train_iteration()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.ppotrainer.print_memory_usage"><code class="docutils literal notranslate"><span class="pre">print_memory_usage()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.trainer.start_trainer">Start Trainer</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.trainer.start_trainer.start_trainer"><code class="docutils literal notranslate"><span class="pre">start_trainer()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utils">Utils</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.utils.rollout.datatypes">Rollout Utils</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict"><code class="docutils literal notranslate"><span class="pre">FragmentDataDict</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.datatypes.FragmentDataDict.format_batch"><code class="docutils literal notranslate"><span class="pre">FragmentDataDict.format_batch()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.datatypes.FragmentIndex"><code class="docutils literal notranslate"><span class="pre">FragmentIndex</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.datatypes.FragmentMetadata"><code class="docutils literal notranslate"><span class="pre">FragmentMetadata</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.datatypes.SampleFragment"><code class="docutils literal notranslate"><span class="pre">SampleFragment</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.datatypes.SampleFragment.index"><code class="docutils literal notranslate"><span class="pre">SampleFragment.index</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.datatypes.SampleFragment.print"><code class="docutils literal notranslate"><span class="pre">SampleFragment.print()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.datatypes.StepRecord"><code class="docutils literal notranslate"><span class="pre">StepRecord</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.monitor.MovingStat"><code class="docutils literal notranslate"><span class="pre">MovingStat</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.monitor.MovingStat.average"><code class="docutils literal notranslate"><span class="pre">MovingStat.average()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.monitor.MovingStat.update"><code class="docutils literal notranslate"><span class="pre">MovingStat.update()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.monitor.PipelineMonitor"><code class="docutils literal notranslate"><span class="pre">PipelineMonitor</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.monitor.PipelineMonitor.print"><code class="docutils literal notranslate"><span class="pre">PipelineMonitor.print()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.rollout.monitor.PipelineMonitor.report_enter"><code class="docutils literal notranslate"><span class="pre">PipelineMonitor.report_enter()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.online.utils.train.data">Trainer Utils</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.train.data.batchify_next_obs"><code class="docutils literal notranslate"><span class="pre">batchify_next_obs()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.train.data.create_loader_pool"><code class="docutils literal notranslate"><span class="pre">create_loader_pool()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.train.data.data_iter"><code class="docutils literal notranslate"><span class="pre">data_iter()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.train.data.prepare_batch"><code class="docutils literal notranslate"><span class="pre">prepare_batch()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.train.gae.get_last_fragment_indexes"><code class="docutils literal notranslate"><span class="pre">get_last_fragment_indexes()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.train.wandb_logger.define_metric"><code class="docutils literal notranslate"><span class="pre">define_metric()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.train.wandb_logger.log"><code class="docutils literal notranslate"><span class="pre">log()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.online.utils.train.wandb_logger.log_video"><code class="docutils literal notranslate"><span class="pre">log_video()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/api/online/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, The CraftJarvis Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>