
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Offline API Documentation &#8212; MineStudio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=d6734ac8" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=cb7bf70b"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/offline/index';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://craftjarvis.github.io/MineStudio/_static/version.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'latest';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <script defer="defer" src="../../_static/custom-icons.js?v=26a3f3bc"></script>
    <link rel="icon" href="../../_static/logo-no-text-light.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Online API Documentation" href="../online/index.html" />
    <link rel="prev" title="Models API Documentation" href="../models/index.html" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />   
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-no-text-light.svg" class="logo__image only-light" alt=""/>
    <img src="../../_static/logo-no-text-light.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">MineStudio</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../overview/index.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../overview/getting-started.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../simulator/index.html">
    Simulator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../data/index.html">
    Data
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../models/index.html">
    Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../offline/index.html">
    Offline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../online/index.html">
    Online
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../inference/index.html">
    Inference
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../benchmark/index.html">
    Benchmark
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../index.html">
    API
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CraftJarvis/MineStudio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/minestudio" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://arxiv.org/pdf/2310.08235" title="ArXiv" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-arxiv fa-lg" aria-hidden="true"></i>
            <span class="sr-only">ArXiv</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
          
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../overview/index.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../overview/getting-started.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../simulator/index.html">
    Simulator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../data/index.html">
    Data
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../models/index.html">
    Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../offline/index.html">
    Offline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../online/index.html">
    Online
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../inference/index.html">
    Inference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../benchmark/index.html">
    Benchmark
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    API
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/CraftJarvis/MineStudio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/minestudio" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://arxiv.org/pdf/2310.08235" title="ArXiv" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-arxiv fa-lg" aria-hidden="true"></i>
            <span class="sr-only">ArXiv</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../overview/installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MineStudio Libraries</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../simulator/index.html">Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../simulator/general-information.html">General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../simulator/design-principles.html">Design Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../simulator/play.html">Graphical User Interfaces</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../data/index.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../data/dataset-raw.html">Raw Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/dataset-event.html">Event Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/convertion.html">Data Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/callbacks.html">Data Processing Callbacks</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline-vpt.html">Built-in Models: VPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline-steve1.html">Built-in Models: STEVE-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline-groot.html">Built-in Models: GROOT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline-rocket1.html">Built-in Models: ROCKET-1</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../offline/index.html">Offline Training</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../offline/tutorial-vpt.html">Tutorial: Fine-tuning VPT to a Hunter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../offline/tutorial-rocket.html">Tutorial: Pre-Training ROCKET-1 from Scratch</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../online/index.html">Online Training</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../online/general-information.html">Online Training Module: General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/config.html">Configuring Online Training Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/trainer.html">Trainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/rollout.html">Rollout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/run.html">Launching Online Training: The <code class="docutils literal notranslate"><span class="pre">run.py</span></code> Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/utils.html">Shared Utilities for Online Training: The <code class="docutils literal notranslate"><span class="pre">utils</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../online/customization.html">Customize</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../inference/index.html">Inference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../inference/baseline-vpt.html">Tutorial: Inference with VPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../inference/baseline-groot.html">Tutorial: Inference with GROOT</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../benchmark/index.html">Benchmark</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../benchmark/quick-benchmark.html">Quick benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../benchmark/automatic-evaluation.html">Automatic Evaluation Pipeline</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">MineStudio API Documentation</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../simulator/index.html">Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../data/index.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../models/index.html">Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="current reference internal" href="#">Offline</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../online/index.html">Online</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../inference/index.html">Inference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../overview/index.html" class="nav-link">Overview</a></li>
    
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">MineStudio API Documentation</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Offline API Documentation</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                   <section id="offline-api-documentation">
<h1>Offline API Documentation<a class="headerlink" href="#offline-api-documentation" title="Link to this heading">#</a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="module-minestudio.offline.trainer">
<span id="trainer"></span><h2>Trainer<a class="headerlink" href="#module-minestudio.offline.trainer" title="Link to this heading">#</a></h2>
<p>Date: 2024-11-10 13:44:13
LastEditors: muzhancun <a class="reference external" href="mailto:muzhancun&#37;&#52;&#48;126&#46;com">muzhancun<span>&#64;</span>126<span>&#46;</span>com</a>
LastEditTime: 2025-01-18 13:52:32
FilePath: /MineStudio/minestudio/offline/trainer.py</p>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.offline.trainer.MineLightning">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.offline.trainer.</span></span><span class="sig-name descname"><span class="pre">MineLightning</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mine_policy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../models/index.html#minestudio.models.base_policy.MinePolicy" title="minestudio.models.base_policy.MinePolicy"><span class="pre">MinePolicy</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">callbacks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#minestudio.offline.mine_callbacks.callback.ObjectiveCallback" title="minestudio.offline.mine_callbacks.callback.ObjectiveCallback"><span class="pre">ObjectiveCallback</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyperparameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_freq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warmup_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_decay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.01</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/trainer.html#MineLightning"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.trainer.MineLightning" title="Link to this definition">#</a></dt>
<dd><p>A PyTorch Lightning module for training MinePolicy models.</p>
<p>This class encapsulates the training, validation, and optimization logic
for MinePolicy models. It handles memory management, batch processing,
and integration with ObjectiveCallbacks for custom training objectives.</p>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.trainer.MineLightning.configure_optimizers">
<span class="sig-name descname"><span class="pre">configure_optimizers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/trainer.html#MineLightning.configure_optimizers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.trainer.MineLightning.configure_optimizers" title="Link to this definition">#</a></dt>
<dd><p>Configures the optimizer and learning rate scheduler.</p>
<p>This function sets up an AdamW optimizer and a linear warmup learning
rate scheduler.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dictionary containing the optimizer and learning rate scheduler.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.trainer.MineLightning.training_step">
<span class="sig-name descname"><span class="pre">training_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/trainer.html#MineLightning.training_step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.trainer.MineLightning.training_step" title="Link to this definition">#</a></dt>
<dd><p>Performs a training step.</p>
<p>This function calls _batch_step with step_name=’train’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> (<em>dict</em>) – The input batch data.</p></li>
<li><p><strong>batch_idx</strong> (<em>int</em>) – The index of the current batch.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the loss and other metrics.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.trainer.MineLightning.validation_step">
<span class="sig-name descname"><span class="pre">validation_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/trainer.html#MineLightning.validation_step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.trainer.MineLightning.validation_step" title="Link to this definition">#</a></dt>
<dd><p>Performs a validation step.</p>
<p>This function calls _batch_step with step_name=’val’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> (<em>dict</em>) – The input batch data.</p></li>
<li><p><strong>batch_idx</strong> (<em>int</em>) – The index of the current batch.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the loss and other metrics.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.offline.trainer.tree_detach">
<span class="sig-prename descclassname"><span class="pre">minestudio.offline.trainer.</span></span><span class="sig-name descname"><span class="pre">tree_detach</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/trainer.html#tree_detach"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.trainer.tree_detach" title="Link to this definition">#</a></dt>
<dd><p>Detaches a tree of tensors from the computation graph.</p>
<p>This function recursively traverses a nested structure (dictionary or list)
and detaches any PyTorch tensors it encounters. This is useful for
preventing gradients from flowing back through the detached tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tree</strong> (<em>dict</em><em> | </em><em>list</em><em> | </em><em>torch.Tensor</em>) – The nested structure (dict, list, or tensor) to detach.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The detached tree.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict | list | torch.Tensor</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-minestudio.offline.utils">
<span id="utils"></span><h2>Utils<a class="headerlink" href="#module-minestudio.offline.utils" title="Link to this heading">#</a></h2>
<p>Date: 2024-11-26 06:26:26
LastEditors: caishaofei <a class="reference external" href="mailto:caishaofei&#37;&#52;&#48;stu&#46;pku&#46;edu&#46;cn">caishaofei<span>&#64;</span>stu<span>&#46;</span>pku<span>&#46;</span>edu<span>&#46;</span>cn</a>
LastEditTime: 2024-11-26 06:28:27
FilePath: /MineStudio/minestudio/train/utils.py</p>
<dl class="py function">
<dt class="sig sig-object py" id="minestudio.offline.utils.convert_to_normal">
<span class="sig-prename descclassname"><span class="pre">minestudio.offline.utils.</span></span><span class="sig-name descname"><span class="pre">convert_to_normal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/utils.html#convert_to_normal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.utils.convert_to_normal" title="Link to this definition">#</a></dt>
<dd><p>Recursively converts OmegaConf DictConfig and ListConfig objects to standard Python dicts and lists.</p>
<p>This function is useful when working with configurations loaded by OmegaConf,
as it allows you to convert them to native Python types for easier manipulation
or serialization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>obj</strong> (<em>Any</em>) – The object to convert. Can be a DictConfig, ListConfig, or any other type.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The converted object, with DictConfig and ListConfig instances replaced by dicts and lists respectively.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Any</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="lightning-callbacks">
<h2>Lightning Callbacks<a class="headerlink" href="#lightning-callbacks" title="Link to this heading">#</a></h2>
<section id="module-minestudio.offline.lightning_callbacks.ema">
<span id="ema-callback"></span><h3>EMA Callback<a class="headerlink" href="#module-minestudio.offline.lightning_callbacks.ema" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.offline.lightning_callbacks.ema.</span></span><span class="sig-name descname"><span class="pre">EMA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">decay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validate_original_weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">every_n_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cpu_offload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA" title="Link to this definition">#</a></dt>
<dd><p>Implements Exponential Moving Averaging (EMA) for PyTorch Lightning.</p>
<p>This callback maintains moving averages of the trained parameters during training.
When evaluating or testing, it can swap the original weights with the EMA weights.
When saving a checkpoint, it saves an additional set of parameters with the prefix <cite>ema</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>decay</strong> (<em>float</em>) – The exponential decay factor used for calculating the moving average. Must be between 0 and 1.</p></li>
<li><p><strong>validate_original_weights</strong> (<em>bool</em>) – If True, validates the original weights instead of the EMA weights. Defaults to False.</p></li>
<li><p><strong>every_n_steps</strong> (<em>int</em>) – Apply EMA every N training steps. Defaults to 1.</p></li>
<li><p><strong>cpu_offload</strong> (<em>bool</em>) – If True, offloads EMA weights to CPU to save GPU memory. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>MisconfigurationException</strong> – If the decay value is not between 0 and 1.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.on_fit_start">
<span class="sig-name descname"><span class="pre">on_fit_start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pl_module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LightningModule</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.on_fit_start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_fit_start" title="Link to this definition">#</a></dt>
<dd><p>Called when the fit begins.</p>
<p>Wraps the optimizers with EMAOptimizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p></li>
<li><p><strong>pl_module</strong> (<em>pl.LightningModule</em>) – The PyTorch Lightning LightningModule instance.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.on_load_checkpoint">
<span class="sig-name descname"><span class="pre">on_load_checkpoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pl_module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LightningModule</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkpoint</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.on_load_checkpoint"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_load_checkpoint" title="Link to this definition">#</a></dt>
<dd><p>Called when a checkpoint is loaded.</p>
<p>Handles loading of EMA weights and optimizer states. If an EMA checkpoint
(e.g., <cite>model-EMA.ckpt</cite>) is loaded, it treats the EMA weights as the main
weights. If a regular checkpoint is loaded, it looks for an associated
EMA checkpoint and restores the EMA state from it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p></li>
<li><p><strong>pl_module</strong> (<em>pl.LightningModule</em>) – The PyTorch Lightning LightningModule instance.</p></li>
<li><p><strong>checkpoint</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – The loaded checkpoint dictionary.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>MisconfigurationException</strong> – If a regular checkpoint is loaded but its associated EMA checkpoint is not found.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.on_test_end">
<span class="sig-name descname"><span class="pre">on_test_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pl_module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LightningModule</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.on_test_end"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_test_end" title="Link to this definition">#</a></dt>
<dd><p>Called when the test loop ends.</p>
<p>Swaps back to original weights if EMA weights were used for testing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p></li>
<li><p><strong>pl_module</strong> (<em>pl.LightningModule</em>) – The PyTorch Lightning LightningModule instance.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.on_test_start">
<span class="sig-name descname"><span class="pre">on_test_start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pl_module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LightningModule</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.on_test_start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_test_start" title="Link to this definition">#</a></dt>
<dd><p>Called when the test loop begins.</p>
<p>Swaps to EMA weights if <cite>validate_original_weights</cite> is False.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p></li>
<li><p><strong>pl_module</strong> (<em>pl.LightningModule</em>) – The PyTorch Lightning LightningModule instance.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.on_validation_end">
<span class="sig-name descname"><span class="pre">on_validation_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pl_module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LightningModule</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.on_validation_end"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_validation_end" title="Link to this definition">#</a></dt>
<dd><p>Called when the validation loop ends.</p>
<p>Swaps back to original weights if EMA weights were used for validation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p></li>
<li><p><strong>pl_module</strong> (<em>pl.LightningModule</em>) – The PyTorch Lightning LightningModule instance.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.on_validation_start">
<span class="sig-name descname"><span class="pre">on_validation_start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pl_module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LightningModule</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.on_validation_start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_validation_start" title="Link to this definition">#</a></dt>
<dd><p>Called when the validation loop begins.</p>
<p>Swaps to EMA weights if <cite>validate_original_weights</cite> is False.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p></li>
<li><p><strong>pl_module</strong> (<em>pl.LightningModule</em>) – The PyTorch Lightning LightningModule instance.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.save_ema_model">
<span class="sig-name descname"><span class="pre">save_ema_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.save_ema_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.save_ema_model" title="Link to this definition">#</a></dt>
<dd><p>A context manager to save an EMA copy of the model and EMA optimizer states.</p>
<p>Temporarily swaps to EMA weights, yields, and then swaps back.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.save_original_optimizer_state">
<span class="sig-name descname"><span class="pre">save_original_optimizer_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.save_original_optimizer_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.save_original_optimizer_state" title="Link to this definition">#</a></dt>
<dd><p>A context manager to temporarily set the <cite>save_original_optimizer_state</cite> flag in EMAOptimizers.</p>
<p>This is used to ensure that the original optimizer state is saved instead of the EMA optimizer state.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMA.swap_model_weights">
<span class="sig-name descname"><span class="pre">swap_model_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Trainer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saving_ema_model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMA.swap_model_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMA.swap_model_weights" title="Link to this definition">#</a></dt>
<dd><p>Swaps the model’s main parameters with the EMA parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p></li>
<li><p><strong>saving_ema_model</strong> (<em>bool</em>) – If True, indicates that the EMA model is being saved. Defaults to False.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.offline.lightning_callbacks.ema.</span></span><span class="sig-name descname"><span class="pre">EMAOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optimizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.9999</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">every_n_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer" title="Link to this definition">#</a></dt>
<dd><p>Wraps a PyTorch optimizer to compute Exponential Moving Average (EMA) of model parameters.</p>
<p>EMA parameters are updated after each optimizer step using the formula:
<cite>ema_weight = decay * ema_weight + (1 - decay) * training_weight</cite></p>
<p>Use the <cite>swap_ema_weights()</cite> context manager to temporarily swap the model’s
regular parameters with the EMA parameters, typically for evaluation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>EMAOptimizer is not compatible with APEX AMP O2.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>optimizer</strong> (<em>torch.optim.Optimizer</em>) – The PyTorch optimizer to wrap.</p></li>
<li><p><strong>device</strong> (<em>torch.device</em>) – The device to store EMA parameters on (e.g., ‘cuda’, ‘cpu’).</p></li>
<li><p><strong>decay</strong> (<em>float</em>) – The EMA decay factor. Defaults to 0.9999.</p></li>
<li><p><strong>every_n_steps</strong> (<em>int</em>) – Apply EMA update every N optimizer steps. Defaults to 1.</p></li>
<li><p><strong>current_step</strong> (<em>int</em>) – The initial training step. Defaults to 0.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.add_param_group">
<span class="sig-name descname"><span class="pre">add_param_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">param_group</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.add_param_group"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.add_param_group" title="Link to this definition">#</a></dt>
<dd><p>Adds a parameter group to the underlying optimizer.</p>
<p>Also flags that EMA parameters need to be rebuilt to include parameters
from the new group.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>param_group</strong> (<em>dict</em>) – The parameter group to add.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.all_parameters">
<span class="sig-name descname"><span class="pre">all_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.all_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.all_parameters" title="Link to this definition">#</a></dt>
<dd><p>Returns an iterator over all parameters managed by the optimizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An iterator over all parameters.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Iterable[torch.Tensor]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.join">
<span class="sig-name descname"><span class="pre">join</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.join"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.join" title="Link to this definition">#</a></dt>
<dd><p>Waits for any asynchronous EMA update (CUDA stream or CPU thread) to complete.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.load_state_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.load_state_dict" title="Link to this definition">#</a></dt>
<dd><p>Loads the EMAOptimizer state.</p>
<p>Restores the state of the underlying optimizer, EMA parameters, current_step,
decay, and <cite>every_n_steps</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state_dict</strong> (<em>dict</em>) – The EMAOptimizer state dictionary to load.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.state_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.state_dict" title="Link to this definition">#</a></dt>
<dd><p>Returns the state of the EMAOptimizer.</p>
<p>Includes the state of the underlying optimizer, the EMA parameters,
the current step, decay, and <cite>every_n_steps</cite>. If <cite>save_original_optimizer_state</cite>
is True, only the original optimizer’s state is returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dictionary containing the EMAOptimizer state.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">closure</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.step" title="Link to this definition">#</a></dt>
<dd><p>Performs a single optimization step.</p>
<p>This method calls the underlying optimizer’s step() method and then,
if applicable, updates the EMA parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>closure</strong> (<em>callable</em><em>, </em><em>optional</em>) – A closure that re-evaluates the model and returns the loss. Optional for most optimizers.</p></li>
<li><p><strong>grad_scaler</strong> (<em>torch.cuda.amp.GradScaler</em><em>, </em><em>optional</em>) – A <cite>torch.cuda.amp.GradScaler</cite> instance for mixed-precision training. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The loss computed by the closure, or None if no closure is provided.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.swap_ema_weights">
<span class="sig-name descname"><span class="pre">swap_ema_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enabled</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.swap_ema_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.swap_ema_weights" title="Link to this definition">#</a></dt>
<dd><p>A context manager to in-place swap regular model parameters with EMA parameters.</p>
<p>Swaps back to the original regular parameters upon exiting the context.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>enabled</strong> (<em>bool</em>) – If False, the swap is not performed. Defaults to True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.swap_tensors">
<span class="sig-name descname"><span class="pre">swap_tensors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tensor2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.swap_tensors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.swap_tensors" title="Link to this definition">#</a></dt>
<dd><p>Swaps the data of two tensors in-place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor1</strong> (<em>torch.Tensor</em>) – The first tensor.</p></li>
<li><p><strong>tensor2</strong> (<em>torch.Tensor</em>) – The second tensor.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.switch_main_parameter_weights">
<span class="sig-name descname"><span class="pre">switch_main_parameter_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">saving_ema_model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.switch_main_parameter_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.switch_main_parameter_weights" title="Link to this definition">#</a></dt>
<dd><p>Swaps the main model parameters with the EMA parameters.</p>
<p>This method is called by the EMA callback or the <cite>swap_ema_weights</cite>
context manager.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>saving_ema_model</strong> (<em>bool</em>) – If True, indicates that the EMA model is being saved.
This affects how <cite>state_dict</cite> behaves. Defaults to False.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.EMAOptimizer.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#EMAOptimizer.update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.update" title="Link to this definition">#</a></dt>
<dd><p>Performs the EMA update for the parameters.</p>
<p>This method detaches the current model parameters, moves them to the EMA
device, and then calls <cite>ema_update</cite> (or <cite>run_ema_update_cpu</cite> if offloading
to CPU) to update the EMA parameters.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.ema_update">
<span class="sig-prename descclassname"><span class="pre">minestudio.offline.lightning_callbacks.ema.</span></span><span class="sig-name descname"><span class="pre">ema_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ema_model_tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_model_tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decay</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#ema_update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.ema_update" title="Link to this definition">#</a></dt>
<dd><p>Performs the EMA update step.</p>
<p>Updates the EMA parameters using the formula:
<cite>ema_weight = decay * ema_weight + (1 - decay) * current_weight</cite></p>
<p>This function uses <cite>torch._foreach_mul_</cite> and <cite>torch._foreach_add_</cite> for efficient
element-wise operations on tuples of tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ema_model_tuple</strong> (<em>tuple</em><em>[</em><em>torch.Tensor</em><em>]</em>) – A tuple of EMA parameter tensors.</p></li>
<li><p><strong>current_model_tuple</strong> (<em>tuple</em><em>[</em><em>torch.Tensor</em><em>]</em>) – A tuple of current model parameter tensors.</p></li>
<li><p><strong>decay</strong> (<em>float</em>) – The EMA decay factor.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.ema.run_ema_update_cpu">
<span class="sig-prename descclassname"><span class="pre">minestudio.offline.lightning_callbacks.ema.</span></span><span class="sig-name descname"><span class="pre">run_ema_update_cpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ema_model_tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_model_tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decay</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_sync_stream</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/ema.html#run_ema_update_cpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.ema.run_ema_update_cpu" title="Link to this definition">#</a></dt>
<dd><p>Runs the EMA update on the CPU.</p>
<p>This function is typically used when EMA parameters are offloaded to the CPU.
It synchronizes with a CUDA stream if provided, then calls <cite>ema_update</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ema_model_tuple</strong> (<em>tuple</em><em>[</em><em>torch.Tensor</em><em>]</em>) – A tuple of EMA parameter tensors.</p></li>
<li><p><strong>current_model_tuple</strong> (<em>tuple</em><em>[</em><em>torch.Tensor</em><em>]</em>) – A tuple of current model parameter tensors.</p></li>
<li><p><strong>decay</strong> (<em>float</em>) – The EMA decay factor.</p></li>
<li><p><strong>pre_sync_stream</strong> (<em>torch.cuda.Stream</em><em> | </em><em>None</em>) – A CUDA stream to synchronize with before the update. Defaults to None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-minestudio.offline.lightning_callbacks.smart_checkpoint">
<span id="smart-checkpoint-callback"></span><h3>Smart Checkpoint Callback<a class="headerlink" href="#module-minestudio.offline.lightning_callbacks.smart_checkpoint" title="Link to this heading">#</a></h3>
<p>Date: 2024-11-28 15:37:18
LastEditors: muzhancun <a class="reference external" href="mailto:muzhancun&#37;&#52;&#48;stu&#46;pku&#46;edu&#46;cn">muzhancun<span>&#64;</span>stu<span>&#46;</span>pku<span>&#46;</span>edu<span>&#46;</span>cn</a>
LastEditTime: 2025-05-27 14:03:44
FilePath: /MineStudio/minestudio/offline/lightning_callbacks/smart_checkpoint.py</p>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.smart_checkpoint.SmartCheckpointCallback">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.offline.lightning_callbacks.smart_checkpoint.</span></span><span class="sig-name descname"><span class="pre">SmartCheckpointCallback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/smart_checkpoint.html#SmartCheckpointCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.smart_checkpoint.SmartCheckpointCallback" title="Link to this definition">#</a></dt>
<dd><p>A PyTorch Lightning ModelCheckpoint callback that is aware of EMA (Exponential Moving Average) weights.</p>
<p>This callback extends the standard ModelCheckpoint to also save and remove
EMA weights if an EMA callback is present in the trainer.
EMA checkpoints are saved with an ‘-EMA’ suffix before the file extension.</p>
</dd></dl>

</section>
<section id="module-minestudio.offline.lightning_callbacks.speed_monitor">
<span id="speed-monitor-callback"></span><h3>Speed Monitor Callback<a class="headerlink" href="#module-minestudio.offline.lightning_callbacks.speed_monitor" title="Link to this heading">#</a></h3>
<p>Date: 2024-11-28 15:35:51
LastEditors: caishaofei <a class="reference external" href="mailto:caishaofei&#37;&#52;&#48;stu&#46;pku&#46;edu&#46;cn">caishaofei<span>&#64;</span>stu<span>&#46;</span>pku<span>&#46;</span>edu<span>&#46;</span>cn</a>
LastEditTime: 2024-11-28 15:37:52
FilePath: /MineStudio/minestudio/train/lightning_callbacks/speed_monitor.py</p>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.speed_monitor.SpeedMonitorCallback">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.offline.lightning_callbacks.speed_monitor.</span></span><span class="sig-name descname"><span class="pre">SpeedMonitorCallback</span></span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/speed_monitor.html#SpeedMonitorCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.speed_monitor.SpeedMonitorCallback" title="Link to this definition">#</a></dt>
<dd><p>A PyTorch Lightning callback to monitor training speed.</p>
<p>This callback logs the training speed in batches per second at regular intervals.
It only logs on the global rank 0 process to avoid redundant logging in
distributed training setups.</p>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.lightning_callbacks.speed_monitor.SpeedMonitorCallback.on_train_batch_end">
<span class="sig-name descname"><span class="pre">on_train_batch_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trainer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pl_module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/lightning_callbacks/speed_monitor.html#SpeedMonitorCallback.on_train_batch_end"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.lightning_callbacks.speed_monitor.SpeedMonitorCallback.on_train_batch_end" title="Link to this definition">#</a></dt>
<dd><p>Called at the end of each training batch.</p>
<p>Calculates and logs the training speed every <cite>INTERVAL</cite> batches on rank 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trainer</strong> (<em>pl.Trainer</em>) – The PyTorch Lightning Trainer instance.</p></li>
<li><p><strong>pl_module</strong> (<em>pl.LightningModule</em>) – The PyTorch Lightning LightningModule instance.</p></li>
<li><p><strong>outputs</strong> (<em>Any</em>) – The outputs of the training step.</p></li>
<li><p><strong>batch</strong> (<em>Any</em>) – The current batch of data.</p></li>
<li><p><strong>batch_idx</strong> (<em>int</em>) – The index of the current batch.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="mine-callbacks">
<h2>Mine Callbacks<a class="headerlink" href="#mine-callbacks" title="Link to this heading">#</a></h2>
<section id="module-minestudio.offline.mine_callbacks.behavior_clone">
<span id="behavior-clone-callback"></span><h3>Behavior Clone Callback<a class="headerlink" href="#module-minestudio.offline.mine_callbacks.behavior_clone" title="Link to this heading">#</a></h3>
<p>Date: 2024-11-12 13:59:08
LastEditors: caishaofei <a class="reference external" href="mailto:caishaofei&#37;&#52;&#48;stu&#46;pku&#46;edu&#46;cn">caishaofei<span>&#64;</span>stu<span>&#46;</span>pku<span>&#46;</span>edu<span>&#46;</span>cn</a>
LastEditTime: 2024-12-09 15:51:34
FilePath: /MineStudio/minestudio/train/mine_callbacks/behavior_clone.py</p>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.offline.mine_callbacks.behavior_clone.BehaviorCloneCallback">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.offline.mine_callbacks.behavior_clone.</span></span><span class="sig-name descname"><span class="pre">BehaviorCloneCallback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/mine_callbacks/behavior_clone.html#BehaviorCloneCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.mine_callbacks.behavior_clone.BehaviorCloneCallback" title="Link to this definition">#</a></dt>
<dd><p>A callback for behavior cloning.</p>
<p>This callback calculates the behavior cloning loss, which is the negative
log-likelihood of the agent’s actions under the policy’s action distribution.
It also calculates the entropy of the policy’s action distribution.</p>
</dd></dl>

</section>
<section id="module-minestudio.offline.mine_callbacks.callback">
<span id="callback"></span><h3>Callback<a class="headerlink" href="#module-minestudio.offline.mine_callbacks.callback" title="Link to this heading">#</a></h3>
<p>Date: 2024-11-12 10:57:29
LastEditors: muzhancun <a class="reference external" href="mailto:muzhancun&#37;&#52;&#48;126&#46;com">muzhancun<span>&#64;</span>126<span>&#46;</span>com</a>
LastEditTime: 2025-01-18 13:53:17
FilePath: /MineStudio/minestudio/offline/mine_callbacks/callback.py</p>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.offline.mine_callbacks.callback.ObjectiveCallback">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.offline.mine_callbacks.callback.</span></span><span class="sig-name descname"><span class="pre">ObjectiveCallback</span></span><a class="reference internal" href="../../_modules/minestudio/offline/mine_callbacks/callback.html#ObjectiveCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.mine_callbacks.callback.ObjectiveCallback" title="Link to this definition">#</a></dt>
<dd><p>Base class for objective callbacks used in MineLightning training.</p>
<p>Objective callbacks are used to define and calculate specific loss components
or metrics during the training or validation step. Subclasses should implement
the <cite>__call__</cite> method to compute their specific objective.</p>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.mine_callbacks.callback.ObjectiveCallback.before_step">
<span class="sig-name descname"><span class="pre">before_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/mine_callbacks/callback.html#ObjectiveCallback.before_step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.mine_callbacks.callback.ObjectiveCallback.before_step" title="Link to this definition">#</a></dt>
<dd><p>A hook called before the main batch step processing.</p>
<p>This can be used to modify the batch or perform other actions before
the model forward pass and objective calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – The input batch data.</p></li>
<li><p><strong>batch_idx</strong> (<em>int</em>) – The index of the current batch.</p></li>
<li><p><strong>step_name</strong> (<em>str</em>) – The name of the current step (e.g., ‘train’, ‘val’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The (potentially modified) batch data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-minestudio.offline.mine_callbacks.kl_divergence">
<span id="kl-divergence-callback"></span><h3>KL Divergence Callback<a class="headerlink" href="#module-minestudio.offline.mine_callbacks.kl_divergence" title="Link to this heading">#</a></h3>
<p>Date: 2024-12-12 13:10:58
LastEditors: muzhancun <a class="reference external" href="mailto:muzhancun&#37;&#52;&#48;stu&#46;pku&#46;edu&#46;cn">muzhancun<span>&#64;</span>stu<span>&#46;</span>pku<span>&#46;</span>edu<span>&#46;</span>cn</a>
LastEditTime: 2025-05-27 14:14:37
FilePath: /MineStudio/minestudio/offline/mine_callbacks/kl_divergence.py</p>
<dl class="py class">
<dt class="sig sig-object py" id="minestudio.offline.mine_callbacks.kl_divergence.KLDivergenceCallback">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">minestudio.offline.mine_callbacks.kl_divergence.</span></span><span class="sig-name descname"><span class="pre">KLDivergenceCallback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/mine_callbacks/kl_divergence.html#KLDivergenceCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.mine_callbacks.kl_divergence.KLDivergenceCallback" title="Link to this definition">#</a></dt>
<dd><p>A callback to compute the KL divergence between two Gaussian distributions.</p>
<p>This callback is typically used in Variational Autoencoders (VAEs) or similar
models where a prior distribution is regularized towards a posterior distribution.
The KL divergence is calculated between a posterior (q) and a prior (p) distribution,
both assumed to be Gaussian and defined by their means (mu) and log variances (log_var).</p>
<dl class="py method">
<dt class="sig sig-object py" id="minestudio.offline.mine_callbacks.kl_divergence.KLDivergenceCallback.kl_divergence">
<span class="sig-name descname"><span class="pre">kl_divergence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q_mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_log_var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_log_var</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/minestudio/offline/mine_callbacks/kl_divergence.html#KLDivergenceCallback.kl_divergence"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#minestudio.offline.mine_callbacks.kl_divergence.KLDivergenceCallback.kl_divergence" title="Link to this definition">#</a></dt>
<dd><p>Computes the KL divergence between two Gaussian distributions q and p.</p>
<p>KL(q || p) = -0.5 * sum(1 + log(sigma_q^2 / sigma_p^2) - (sigma_q^2 / sigma_p^2) - ((mu_q - mu_p)^2 / sigma_p^2))
where sigma^2 = exp(log_var).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q_mu</strong> (<em>torch.Tensor</em>) – Mean of the posterior distribution q. Shape: (B, D)</p></li>
<li><p><strong>q_log_var</strong> (<em>torch.Tensor</em>) – Log variance of the posterior distribution q. Shape: (B, D)</p></li>
<li><p><strong>p_mu</strong> (<em>torch.Tensor</em>) – Mean of the prior distribution p. Shape: (B, D)</p></li>
<li><p><strong>p_log_var</strong> (<em>torch.Tensor</em>) – Log variance of the prior distribution p. Shape: (B, D)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The KL divergence for each element in the batch. Shape: (B)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
</section>

<div class="section ablog__blog_comments">
   
</div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../models/index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Models API Documentation</p>
      </div>
    </a>
    <a class="right-next"
       href="../online/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Online API Documentation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.offline.trainer">Trainer</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.trainer.MineLightning"><code class="docutils literal notranslate"><span class="pre">MineLightning</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.trainer.MineLightning.configure_optimizers"><code class="docutils literal notranslate"><span class="pre">MineLightning.configure_optimizers()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.trainer.MineLightning.training_step"><code class="docutils literal notranslate"><span class="pre">MineLightning.training_step()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.trainer.MineLightning.validation_step"><code class="docutils literal notranslate"><span class="pre">MineLightning.validation_step()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.trainer.tree_detach"><code class="docutils literal notranslate"><span class="pre">tree_detach()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.offline.utils">Utils</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.utils.convert_to_normal"><code class="docutils literal notranslate"><span class="pre">convert_to_normal()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lightning-callbacks">Lightning Callbacks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.offline.lightning_callbacks.ema">EMA Callback</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA"><code class="docutils literal notranslate"><span class="pre">EMA</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_fit_start"><code class="docutils literal notranslate"><span class="pre">EMA.on_fit_start()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_load_checkpoint"><code class="docutils literal notranslate"><span class="pre">EMA.on_load_checkpoint()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_test_end"><code class="docutils literal notranslate"><span class="pre">EMA.on_test_end()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_test_start"><code class="docutils literal notranslate"><span class="pre">EMA.on_test_start()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_validation_end"><code class="docutils literal notranslate"><span class="pre">EMA.on_validation_end()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.on_validation_start"><code class="docutils literal notranslate"><span class="pre">EMA.on_validation_start()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.save_ema_model"><code class="docutils literal notranslate"><span class="pre">EMA.save_ema_model()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.save_original_optimizer_state"><code class="docutils literal notranslate"><span class="pre">EMA.save_original_optimizer_state()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMA.swap_model_weights"><code class="docutils literal notranslate"><span class="pre">EMA.swap_model_weights()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.add_param_group"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.add_param_group()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.all_parameters"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.all_parameters()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.join"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.join()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.load_state_dict"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.load_state_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.state_dict"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.state_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.step"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.step()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.swap_ema_weights"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.swap_ema_weights()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.swap_tensors"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.swap_tensors()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.switch_main_parameter_weights"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.switch_main_parameter_weights()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.EMAOptimizer.update"><code class="docutils literal notranslate"><span class="pre">EMAOptimizer.update()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.ema_update"><code class="docutils literal notranslate"><span class="pre">ema_update()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.ema.run_ema_update_cpu"><code class="docutils literal notranslate"><span class="pre">run_ema_update_cpu()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.offline.lightning_callbacks.smart_checkpoint">Smart Checkpoint Callback</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.smart_checkpoint.SmartCheckpointCallback"><code class="docutils literal notranslate"><span class="pre">SmartCheckpointCallback</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.offline.lightning_callbacks.speed_monitor">Speed Monitor Callback</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.speed_monitor.SpeedMonitorCallback"><code class="docutils literal notranslate"><span class="pre">SpeedMonitorCallback</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.lightning_callbacks.speed_monitor.SpeedMonitorCallback.on_train_batch_end"><code class="docutils literal notranslate"><span class="pre">SpeedMonitorCallback.on_train_batch_end()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mine-callbacks">Mine Callbacks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.offline.mine_callbacks.behavior_clone">Behavior Clone Callback</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.mine_callbacks.behavior_clone.BehaviorCloneCallback"><code class="docutils literal notranslate"><span class="pre">BehaviorCloneCallback</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.offline.mine_callbacks.callback">Callback</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.mine_callbacks.callback.ObjectiveCallback"><code class="docutils literal notranslate"><span class="pre">ObjectiveCallback</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.mine_callbacks.callback.ObjectiveCallback.before_step"><code class="docutils literal notranslate"><span class="pre">ObjectiveCallback.before_step()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-minestudio.offline.mine_callbacks.kl_divergence">KL Divergence Callback</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.mine_callbacks.kl_divergence.KLDivergenceCallback"><code class="docutils literal notranslate"><span class="pre">KLDivergenceCallback</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#minestudio.offline.mine_callbacks.kl_divergence.KLDivergenceCallback.kl_divergence"><code class="docutils literal notranslate"><span class="pre">KLDivergenceCallback.kl_divergence()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/api/offline/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, The CraftJarvis Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>